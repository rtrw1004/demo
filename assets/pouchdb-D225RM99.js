var su=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function gt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Kr(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}const Fr={},Gr=Object.freeze(Object.defineProperty({__proto__:null,default:Fr},Symbol.toStringTag,{value:"Module"})),zr=Kr(Gr);var Ze={},pn;function Jr(){return pn||(pn=1,Ze.test=function(){return typeof globalThis.queueMicrotask=="function"},Ze.install=function(e){return function(){globalThis.queueMicrotask(e)}}),Ze}var Ve={},yn;function Qr(){if(yn)return Ve;yn=1;var e=globalThis.MutationObserver||globalThis.WebKitMutationObserver;return Ve.test=function(){return e},Ve.install=function(t){var n=0,r=new e(t),i=globalThis.document.createTextNode("");return r.observe(i,{characterData:!0}),function(){i.data=n=++n%2}},Ve}var et={},mn;function Wr(){return mn||(mn=1,et.test=function(){return globalThis.setImmediate?!1:typeof globalThis.MessageChannel<"u"},et.install=function(e){var t=new globalThis.MessageChannel;return t.port1.onmessage=e,function(){t.port2.postMessage(0)}}),et}var tt={},wn;function Hr(){return wn||(wn=1,tt.test=function(){return"document"in globalThis&&"onreadystatechange"in globalThis.document.createElement("script")},tt.install=function(e){return function(){var t=globalThis.document.createElement("script");return t.onreadystatechange=function(){e(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},globalThis.document.documentElement.appendChild(t),e}}),tt}var nt={},bn;function Xr(){return bn||(bn=1,nt.test=function(){return!0},nt.install=function(e){return function(){setTimeout(e,0)}}),nt}var St,Sn;function Yr(){if(Sn)return St;Sn=1;var e=[zr,Jr(),Qr(),Wr(),Hr(),Xr()],t,n,r=-1,i=[],a=!1;function o(){!t||!n||(t=!1,n.length?i=n.concat(i):r=-1,i.length&&v())}function v(){if(!t){a=!1,t=!0;for(var y=i.length,w=setTimeout(o);y;){for(n=i,i=[];n&&++r<y;)n[r].run();r=-1,y=i.length}n=null,r=-1,t=!1,clearTimeout(w)}}for(var g,_=-1,b=e.length;++_<b;)if(e[_]&&e[_].test&&e[_].test()){g=e[_].install(v);break}function l(y,w){this.fun=y,this.array=w}l.prototype.run=function(){var y=this.fun,w=this.array;switch(w.length){case 0:return y();case 1:return y(w[0]);case 2:return y(w[0],w[1]);case 3:return y(w[0],w[1],w[2]);default:return y.apply(null,w)}},St=p;function p(y){var w=new Array(arguments.length-1);if(arguments.length>1)for(var q=1;q<arguments.length;q++)w[q-1]=arguments[q];i.push(new l(y,w)),!a&&!t&&(a=!0,g())}return St}var Zr=Yr();const qe=gt(Zr);var At={exports:{}},An;function Vr(){return An||(An=1,function(e,t){(function(n){e.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(h,d){var u=h[0],s=h[1],c=h[2],f=h[3];u+=(s&c|~s&f)+d[0]-680876936|0,u=(u<<7|u>>>25)+s|0,f+=(u&s|~u&c)+d[1]-389564586|0,f=(f<<12|f>>>20)+u|0,c+=(f&u|~f&s)+d[2]+606105819|0,c=(c<<17|c>>>15)+f|0,s+=(c&f|~c&u)+d[3]-1044525330|0,s=(s<<22|s>>>10)+c|0,u+=(s&c|~s&f)+d[4]-176418897|0,u=(u<<7|u>>>25)+s|0,f+=(u&s|~u&c)+d[5]+1200080426|0,f=(f<<12|f>>>20)+u|0,c+=(f&u|~f&s)+d[6]-1473231341|0,c=(c<<17|c>>>15)+f|0,s+=(c&f|~c&u)+d[7]-45705983|0,s=(s<<22|s>>>10)+c|0,u+=(s&c|~s&f)+d[8]+1770035416|0,u=(u<<7|u>>>25)+s|0,f+=(u&s|~u&c)+d[9]-1958414417|0,f=(f<<12|f>>>20)+u|0,c+=(f&u|~f&s)+d[10]-42063|0,c=(c<<17|c>>>15)+f|0,s+=(c&f|~c&u)+d[11]-1990404162|0,s=(s<<22|s>>>10)+c|0,u+=(s&c|~s&f)+d[12]+1804603682|0,u=(u<<7|u>>>25)+s|0,f+=(u&s|~u&c)+d[13]-40341101|0,f=(f<<12|f>>>20)+u|0,c+=(f&u|~f&s)+d[14]-1502002290|0,c=(c<<17|c>>>15)+f|0,s+=(c&f|~c&u)+d[15]+1236535329|0,s=(s<<22|s>>>10)+c|0,u+=(s&f|c&~f)+d[1]-165796510|0,u=(u<<5|u>>>27)+s|0,f+=(u&c|s&~c)+d[6]-1069501632|0,f=(f<<9|f>>>23)+u|0,c+=(f&s|u&~s)+d[11]+643717713|0,c=(c<<14|c>>>18)+f|0,s+=(c&u|f&~u)+d[0]-373897302|0,s=(s<<20|s>>>12)+c|0,u+=(s&f|c&~f)+d[5]-701558691|0,u=(u<<5|u>>>27)+s|0,f+=(u&c|s&~c)+d[10]+38016083|0,f=(f<<9|f>>>23)+u|0,c+=(f&s|u&~s)+d[15]-660478335|0,c=(c<<14|c>>>18)+f|0,s+=(c&u|f&~u)+d[4]-405537848|0,s=(s<<20|s>>>12)+c|0,u+=(s&f|c&~f)+d[9]+568446438|0,u=(u<<5|u>>>27)+s|0,f+=(u&c|s&~c)+d[14]-1019803690|0,f=(f<<9|f>>>23)+u|0,c+=(f&s|u&~s)+d[3]-187363961|0,c=(c<<14|c>>>18)+f|0,s+=(c&u|f&~u)+d[8]+1163531501|0,s=(s<<20|s>>>12)+c|0,u+=(s&f|c&~f)+d[13]-1444681467|0,u=(u<<5|u>>>27)+s|0,f+=(u&c|s&~c)+d[2]-51403784|0,f=(f<<9|f>>>23)+u|0,c+=(f&s|u&~s)+d[7]+1735328473|0,c=(c<<14|c>>>18)+f|0,s+=(c&u|f&~u)+d[12]-1926607734|0,s=(s<<20|s>>>12)+c|0,u+=(s^c^f)+d[5]-378558|0,u=(u<<4|u>>>28)+s|0,f+=(u^s^c)+d[8]-2022574463|0,f=(f<<11|f>>>21)+u|0,c+=(f^u^s)+d[11]+1839030562|0,c=(c<<16|c>>>16)+f|0,s+=(c^f^u)+d[14]-35309556|0,s=(s<<23|s>>>9)+c|0,u+=(s^c^f)+d[1]-1530992060|0,u=(u<<4|u>>>28)+s|0,f+=(u^s^c)+d[4]+1272893353|0,f=(f<<11|f>>>21)+u|0,c+=(f^u^s)+d[7]-155497632|0,c=(c<<16|c>>>16)+f|0,s+=(c^f^u)+d[10]-1094730640|0,s=(s<<23|s>>>9)+c|0,u+=(s^c^f)+d[13]+681279174|0,u=(u<<4|u>>>28)+s|0,f+=(u^s^c)+d[0]-358537222|0,f=(f<<11|f>>>21)+u|0,c+=(f^u^s)+d[3]-722521979|0,c=(c<<16|c>>>16)+f|0,s+=(c^f^u)+d[6]+76029189|0,s=(s<<23|s>>>9)+c|0,u+=(s^c^f)+d[9]-640364487|0,u=(u<<4|u>>>28)+s|0,f+=(u^s^c)+d[12]-421815835|0,f=(f<<11|f>>>21)+u|0,c+=(f^u^s)+d[15]+530742520|0,c=(c<<16|c>>>16)+f|0,s+=(c^f^u)+d[2]-995338651|0,s=(s<<23|s>>>9)+c|0,u+=(c^(s|~f))+d[0]-198630844|0,u=(u<<6|u>>>26)+s|0,f+=(s^(u|~c))+d[7]+1126891415|0,f=(f<<10|f>>>22)+u|0,c+=(u^(f|~s))+d[14]-1416354905|0,c=(c<<15|c>>>17)+f|0,s+=(f^(c|~u))+d[5]-57434055|0,s=(s<<21|s>>>11)+c|0,u+=(c^(s|~f))+d[12]+1700485571|0,u=(u<<6|u>>>26)+s|0,f+=(s^(u|~c))+d[3]-1894986606|0,f=(f<<10|f>>>22)+u|0,c+=(u^(f|~s))+d[10]-1051523|0,c=(c<<15|c>>>17)+f|0,s+=(f^(c|~u))+d[1]-2054922799|0,s=(s<<21|s>>>11)+c|0,u+=(c^(s|~f))+d[8]+1873313359|0,u=(u<<6|u>>>26)+s|0,f+=(s^(u|~c))+d[15]-30611744|0,f=(f<<10|f>>>22)+u|0,c+=(u^(f|~s))+d[6]-1560198380|0,c=(c<<15|c>>>17)+f|0,s+=(f^(c|~u))+d[13]+1309151649|0,s=(s<<21|s>>>11)+c|0,u+=(c^(s|~f))+d[4]-145523070|0,u=(u<<6|u>>>26)+s|0,f+=(s^(u|~c))+d[11]-1120210379|0,f=(f<<10|f>>>22)+u|0,c+=(u^(f|~s))+d[2]+718787259|0,c=(c<<15|c>>>17)+f|0,s+=(f^(c|~u))+d[9]-343485551|0,s=(s<<21|s>>>11)+c|0,h[0]=u+h[0]|0,h[1]=s+h[1]|0,h[2]=c+h[2]|0,h[3]=f+h[3]|0}function a(h){var d=[],u;for(u=0;u<64;u+=4)d[u>>2]=h.charCodeAt(u)+(h.charCodeAt(u+1)<<8)+(h.charCodeAt(u+2)<<16)+(h.charCodeAt(u+3)<<24);return d}function o(h){var d=[],u;for(u=0;u<64;u+=4)d[u>>2]=h[u]+(h[u+1]<<8)+(h[u+2]<<16)+(h[u+3]<<24);return d}function v(h){var d=h.length,u=[1732584193,-271733879,-1732584194,271733878],s,c,f,O,E,C;for(s=64;s<=d;s+=64)i(u,a(h.substring(s-64,s)));for(h=h.substring(s-64),c=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<c;s+=1)f[s>>2]|=h.charCodeAt(s)<<(s%4<<3);if(f[s>>2]|=128<<(s%4<<3),s>55)for(i(u,f),s=0;s<16;s+=1)f[s]=0;return O=d*8,O=O.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(O[2],16),C=parseInt(O[1],16)||0,f[14]=E,f[15]=C,i(u,f),u}function g(h){var d=h.length,u=[1732584193,-271733879,-1732584194,271733878],s,c,f,O,E,C;for(s=64;s<=d;s+=64)i(u,o(h.subarray(s-64,s)));for(h=s-64<d?h.subarray(s-64):new Uint8Array(0),c=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<c;s+=1)f[s>>2]|=h[s]<<(s%4<<3);if(f[s>>2]|=128<<(s%4<<3),s>55)for(i(u,f),s=0;s<16;s+=1)f[s]=0;return O=d*8,O=O.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(O[2],16),C=parseInt(O[1],16)||0,f[14]=E,f[15]=C,i(u,f),u}function _(h){var d="",u;for(u=0;u<4;u+=1)d+=r[h>>u*8+4&15]+r[h>>u*8&15];return d}function b(h){var d;for(d=0;d<h.length;d+=1)h[d]=_(h[d]);return h.join("")}b(v("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function h(d,u){return d=d|0||0,d<0?Math.max(d+u,0):Math.min(d,u)}ArrayBuffer.prototype.slice=function(d,u){var s=this.byteLength,c=h(d,s),f=s,O,E,C,P;return u!==n&&(f=h(u,s)),c>f?new ArrayBuffer(0):(O=f-c,E=new ArrayBuffer(O),C=new Uint8Array(E),P=new Uint8Array(this,c,O),C.set(P),E)}}();function l(h){return/[\u0080-\uFFFF]/.test(h)&&(h=unescape(encodeURIComponent(h))),h}function p(h,d){var u=h.length,s=new ArrayBuffer(u),c=new Uint8Array(s),f;for(f=0;f<u;f+=1)c[f]=h.charCodeAt(f);return d?c:s}function y(h){return String.fromCharCode.apply(null,new Uint8Array(h))}function w(h,d,u){var s=new Uint8Array(h.byteLength+d.byteLength);return s.set(new Uint8Array(h)),s.set(new Uint8Array(d),h.byteLength),s}function q(h){var d=[],u=h.length,s;for(s=0;s<u-1;s+=2)d.push(parseInt(h.substr(s,2),16));return String.fromCharCode.apply(String,d)}function m(){this.reset()}return m.prototype.append=function(h){return this.appendBinary(l(h)),this},m.prototype.appendBinary=function(h){this._buff+=h,this._length+=h.length;var d=this._buff.length,u;for(u=64;u<=d;u+=64)i(this._hash,a(this._buff.substring(u-64,u)));return this._buff=this._buff.substring(u-64),this},m.prototype.end=function(h){var d=this._buff,u=d.length,s,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f;for(s=0;s<u;s+=1)c[s>>2]|=d.charCodeAt(s)<<(s%4<<3);return this._finish(c,u),f=b(this._hash),h&&(f=q(f)),this.reset(),f},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},m.prototype.setState=function(h){return this._buff=h.buff,this._length=h.length,this._hash=h.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(h,d){var u=d,s,c,f;if(h[u>>2]|=128<<(u%4<<3),u>55)for(i(this._hash,h),u=0;u<16;u+=1)h[u]=0;s=this._length*8,s=s.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(s[2],16),f=parseInt(s[1],16)||0,h[14]=c,h[15]=f,i(this._hash,h)},m.hash=function(h,d){return m.hashBinary(l(h),d)},m.hashBinary=function(h,d){var u=v(h),s=b(u);return d?q(s):s},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(h){var d=w(this._buff.buffer,h),u=d.length,s;for(this._length+=h.byteLength,s=64;s<=u;s+=64)i(this._hash,o(d.subarray(s-64,s)));return this._buff=s-64<u?new Uint8Array(d.buffer.slice(s-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(h){var d=this._buff,u=d.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c,f;for(c=0;c<u;c+=1)s[c>>2]|=d[c]<<(c%4<<3);return this._finish(s,u),f=b(this._hash),h&&(f=q(f)),this.reset(),f},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var h=m.prototype.getState.call(this);return h.buff=y(h.buff),h},m.ArrayBuffer.prototype.setState=function(h){return h.buff=p(h.buff,!0),m.prototype.setState.call(this,h)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(h,d){var u=g(new Uint8Array(h)),s=b(u);return d?q(s):s},m})}(At)),At.exports}var ei=Vr();const Lt=gt(ei);var rt,ti=new Uint8Array(16);function ni(){if(!rt&&(rt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!rt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return rt(ti)}const ri=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ii(e){return typeof e=="string"&&ri.test(e)}var fe=[];for(var Ot=0;Ot<256;++Ot)fe.push((Ot+256).toString(16).substr(1));function ai(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(fe[e[t+0]]+fe[e[t+1]]+fe[e[t+2]]+fe[e[t+3]]+"-"+fe[e[t+4]]+fe[e[t+5]]+"-"+fe[e[t+6]]+fe[e[t+7]]+"-"+fe[e[t+8]]+fe[e[t+9]]+"-"+fe[e[t+10]]+fe[e[t+11]]+fe[e[t+12]]+fe[e[t+13]]+fe[e[t+14]]+fe[e[t+15]]).toLowerCase();if(!ii(n))throw TypeError("Stringified UUID is invalid");return n}function tn(e,t,n){e=e||{};var r=e.random||(e.rng||ni)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return ai(r)}var it={},On;function si(){if(On)return it;On=1,it.stringify=function(n){var r=[];r.push({obj:n});for(var i="",a,o,v,g,_,b,l,p,y,w,q;a=r.pop();)if(o=a.obj,v=a.prefix||"",g=a.val||"",i+=v,g)i+=g;else if(typeof o!="object")i+=typeof o>"u"?null:JSON.stringify(o);else if(o===null)i+="null";else if(Array.isArray(o)){for(r.push({val:"]"}),_=o.length-1;_>=0;_--)b=_===0?"":",",r.push({obj:o[_],prefix:b});r.push({val:"["})}else{l=[];for(p in o)o.hasOwnProperty(p)&&l.push(p);for(r.push({val:"}"}),_=l.length-1;_>=0;_--)y=l[_],w=o[y],q=_>0?",":"",q+=JSON.stringify(y)+":",r.push({obj:w,prefix:q});r.push({val:"{"})}return i};function e(t,n,r){var i=r[r.length-1];t===i.element&&(r.pop(),i=r[r.length-1]);var a=i.element,o=i.index;if(Array.isArray(a))a.push(t);else if(o===n.length-2){var v=n.pop();a[v]=t}else n.push(t)}return it.parse=function(t){for(var n=[],r=[],i=0,a,o,v,g,_,b,l,p,y;;){if(a=t[i++],a==="}"||a==="]"||typeof a>"u"){if(n.length===1)return n.pop();e(n.pop(),n,r);continue}switch(a){case" ":case"	":case`
`:case":":case",":break;case"n":i+=3,e(null,n,r);break;case"t":i+=3,e(!0,n,r);break;case"f":i+=4,e(!1,n,r);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(o="",i--;;)if(v=t[i++],/[\d\.\-e\+]/.test(v))o+=v;else{i--;break}e(parseFloat(o),n,r);break;case'"':for(g="",_=void 0,b=0;l=t[i++],l!=='"'||_==="\\"&&b%2===1;)g+=l,_=l,_==="\\"?b++:b=0;e(JSON.parse('"'+g+'"'),n,r);break;case"[":p={element:[],index:n.length},n.push(p.element),r.push(p);break;case"{":y={element:{},index:n.length},n.push(y.element),r.push(y);break;default:throw new Error("unexpectedly reached end of input: "+a)}}},it}var ui=si();const nr=gt(ui);var at={exports:{}},qn;function oi(){if(qn)return at.exports;qn=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(c,f,O){return Function.prototype.apply.call(c,f,O)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(c){return Object.getOwnPropertyNames(c).concat(Object.getOwnPropertySymbols(c))}:n=function(c){return Object.getOwnPropertyNames(c)};function r(s){console&&console.warn&&console.warn(s)}var i=Number.isNaN||function(c){return c!==c};function a(){a.init.call(this)}at.exports=a,at.exports.once=h,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function v(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(s){if(typeof s!="number"||s<0||i(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");o=s}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(c){if(typeof c!="number"||c<0||i(c))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+c+".");return this._maxListeners=c,this};function g(s){return s._maxListeners===void 0?a.defaultMaxListeners:s._maxListeners}a.prototype.getMaxListeners=function(){return g(this)},a.prototype.emit=function(c){for(var f=[],O=1;O<arguments.length;O++)f.push(arguments[O]);var E=c==="error",C=this._events;if(C!==void 0)E=E&&C.error===void 0;else if(!E)return!1;if(E){var P;if(f.length>0&&(P=f[0]),P instanceof Error)throw P;var j=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw j.context=P,j}var U=C[c];if(U===void 0)return!1;if(typeof U=="function")t(U,this,f);else for(var K=U.length,N=w(U,K),O=0;O<K;++O)t(N[O],this,f);return!0};function _(s,c,f,O){var E,C,P;if(v(f),C=s._events,C===void 0?(C=s._events=Object.create(null),s._eventsCount=0):(C.newListener!==void 0&&(s.emit("newListener",c,f.listener?f.listener:f),C=s._events),P=C[c]),P===void 0)P=C[c]=f,++s._eventsCount;else if(typeof P=="function"?P=C[c]=O?[f,P]:[P,f]:O?P.unshift(f):P.push(f),E=g(s),E>0&&P.length>E&&!P.warned){P.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=s,j.type=c,j.count=P.length,r(j)}return s}a.prototype.addListener=function(c,f){return _(this,c,f,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(c,f){return _(this,c,f,!0)};function b(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(s,c,f){var O={fired:!1,wrapFn:void 0,target:s,type:c,listener:f},E=b.bind(O);return E.listener=f,O.wrapFn=E,E}a.prototype.once=function(c,f){return v(f),this.on(c,l(this,c,f)),this},a.prototype.prependOnceListener=function(c,f){return v(f),this.prependListener(c,l(this,c,f)),this},a.prototype.removeListener=function(c,f){var O,E,C,P,j;if(v(f),E=this._events,E===void 0)return this;if(O=E[c],O===void 0)return this;if(O===f||O.listener===f)--this._eventsCount===0?this._events=Object.create(null):(delete E[c],E.removeListener&&this.emit("removeListener",c,O.listener||f));else if(typeof O!="function"){for(C=-1,P=O.length-1;P>=0;P--)if(O[P]===f||O[P].listener===f){j=O[P].listener,C=P;break}if(C<0)return this;C===0?O.shift():q(O,C),O.length===1&&(E[c]=O[0]),E.removeListener!==void 0&&this.emit("removeListener",c,j||f)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(c){var f,O,E;if(O=this._events,O===void 0)return this;if(O.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):O[c]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete O[c]),this;if(arguments.length===0){var C=Object.keys(O),P;for(E=0;E<C.length;++E)P=C[E],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(f=O[c],typeof f=="function")this.removeListener(c,f);else if(f!==void 0)for(E=f.length-1;E>=0;E--)this.removeListener(c,f[E]);return this};function p(s,c,f){var O=s._events;if(O===void 0)return[];var E=O[c];return E===void 0?[]:typeof E=="function"?f?[E.listener||E]:[E]:f?m(E):w(E,E.length)}a.prototype.listeners=function(c){return p(this,c,!0)},a.prototype.rawListeners=function(c){return p(this,c,!1)},a.listenerCount=function(s,c){return typeof s.listenerCount=="function"?s.listenerCount(c):y.call(s,c)},a.prototype.listenerCount=y;function y(s){var c=this._events;if(c!==void 0){var f=c[s];if(typeof f=="function")return 1;if(f!==void 0)return f.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function w(s,c){for(var f=new Array(c),O=0;O<c;++O)f[O]=s[O];return f}function q(s,c){for(;c+1<s.length;c++)s[c]=s[c+1];s.pop()}function m(s){for(var c=new Array(s.length),f=0;f<c.length;++f)c[f]=s[f].listener||s[f];return c}function h(s,c){return new Promise(function(f,O){function E(P){s.removeListener(c,C),O(P)}function C(){typeof s.removeListener=="function"&&s.removeListener("error",E),f([].slice.call(arguments))}u(s,c,C,{once:!0}),c!=="error"&&d(s,E,{once:!0})})}function d(s,c,f){typeof s.on=="function"&&u(s,"error",c,f)}function u(s,c,f,O){if(typeof s.on=="function")O.once?s.once(c,f):s.on(c,f);else if(typeof s.addEventListener=="function")s.addEventListener(c,function E(C){O.once&&s.removeEventListener(c,E),f(C)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}return at.exports}var ci=oi();const Ce=gt(ci);function _t(e){return"$"+e}function rr(e){return e.substring(1)}function xe(){this._store={}}xe.prototype.get=function(e){var t=_t(e);return this._store[t]};xe.prototype.set=function(e,t){var n=_t(e);return this._store[n]=t,!0};xe.prototype.has=function(e){var t=_t(e);return t in this._store};xe.prototype.keys=function(){return Object.keys(this._store).map(e=>rr(e))};xe.prototype.delete=function(e){var t=_t(e),n=t in this._store;return delete this._store[t],n};xe.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var i=t[n],a=this._store[i];i=rr(i),e(a,i)}};Object.defineProperty(xe.prototype,"size",{get:function(){return Object.keys(this._store).length}});function He(e){if(this._store=new xe,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}He.prototype.add=function(e){return this._store.set(e,!0)};He.prototype.has=function(e){return this._store.has(e)};He.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})};Object.defineProperty(He.prototype,"size",{get:function(){return this._store.size}});function fi(){if(typeof Symbol>"u"||typeof Map>"u"||typeof Set>"u")return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}var Ke,ve;fi()?(Ke=Set,ve=Map):(Ke=He,ve=xe);function li(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer||typeof Blob<"u"&&e instanceof Blob}function di(e){if(typeof e.slice=="function")return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}function hi(e){if(e instanceof ArrayBuffer)return di(e);var t=e.size,n=e.type;return typeof e.slice=="function"?e.slice(0,t,n):e.webkitSlice(0,t,n)}var ir=Function.prototype.toString,vi=ir.call(Object);function gi(e){var t=Object.getPrototypeOf(e);if(t===null)return!0;var n=t.constructor;return typeof n=="function"&&n instanceof n&&ir.call(n)==vi}function ce(e){var t,n,r;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=ce(e[n]);return t}if(e instanceof Date&&isFinite(e))return e.toISOString();if(li(e))return hi(e);if(!gi(e))return e;t={};for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=ce(e[n]);typeof i<"u"&&(t[n]=i)}return t}function ar(e){var t=!1;return function(...n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}}function sr(e){return function(...t){t=ce(t);var n=this,r=typeof t[t.length-1]=="function"?t.pop():!1,i=new Promise(function(a,o){var v;try{var g=ar(function(_,b){_?o(_):a(b)});t.push(g),v=e.apply(n,t),v&&typeof v.then=="function"&&a(v)}catch(_){o(_)}});return r&&i.then(function(a){r(null,a)},r),i}}function _i(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var a=n[n.length-1];n[n.length-1]=function(o,v){var g=["api",e.name,t];g=g.concat(o?["error",o]:["success",v]),e.constructor.emit("debug",g),a(o,v)}}}function re(e,t){return sr(function(...n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return _i(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise(function(i,a){r.taskqueue.addTask(function(o){o?a(o):i(r[e].apply(r,n))})})})}function Xe(e,t){for(var n={},r=0,i=t.length;r<i;r++){var a=t[r];a in e&&(n[a]=e[a])}return n}var pi=6;function En(e){return e}function yi(e){return[{ok:e}]}function ur(e,t,n){var r=t.docs,i=new ve;r.forEach(function(q){i.has(q.id)?i.get(q.id).push(q):i.set(q.id,[q])});var a=i.size,o=0,v=new Array(a);function g(){var q=[];v.forEach(function(m){m.docs.forEach(function(h){q.push({id:m.id,docs:[h]})})}),n(null,{results:q})}function _(){++o===a&&g()}function b(q,m,h){v[q]={id:m,docs:h},_()}var l=[];i.forEach(function(q,m){l.push(m)});var p=0;function y(){if(!(p>=l.length)){var q=Math.min(p+pi,l.length),m=l.slice(p,q);w(m,p),p+=m.length}}function w(q,m){q.forEach(function(h,d){var u=m+d,s=i.get(h),c=Xe(s[0],["atts_since","attachments"]);c.open_revs=s.map(function(O){return O.rev}),c.open_revs=c.open_revs.filter(En);var f=En;c.open_revs.length===0&&(delete c.open_revs,f=yi),["revs","attachments","binary","ajax","latest"].forEach(function(O){O in t&&(c[O]=t[O])}),e.get(h,c,function(O,E){var C;O?C=[{error:O}]:C=f(E),b(u,h,C),y()})})}y()}var jt;try{localStorage.setItem("_pouch_check_localstorage",1),jt=!!localStorage.getItem("_pouch_check_localstorage")}catch{jt=!1}function ct(){return jt}class mi extends Ce{constructor(){super(),this._listeners={},ct()&&addEventListener("storage",t=>{this.emit(t.key)})}addListener(t,n,r,i){if(this._listeners[n])return;var a=!1,o=this;function v(){if(!o._listeners[n])return;if(a){a="waiting";return}a=!0;var g=Xe(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function _(){a=!1}r.changes(g).on("change",function(b){b.seq>i.since&&!i.cancelled&&(i.since=b.seq,i.onChange(b))}).on("complete",function(){a==="waiting"&&qe(v),a=!1}).on("error",_)}this._listeners[n]=v,this.on(t,v)}removeListener(t,n){n in this._listeners&&(super.removeListener(t,this._listeners[n]),delete this._listeners[n])}notifyLocalWindows(t){ct()&&(localStorage[t]=localStorage[t]==="a"?"b":"a")}notify(t){this.emit(t),this.notifyLocalWindows(t)}}function pe(e){if(typeof console<"u"&&typeof console[e]=="function"){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function wi(e,t){var n=6e5;e=parseInt(e,10)||0,t=parseInt(t,10),t!==t||t<=e?t=(e||1)<<1:t=t+1,t>n&&(e=n>>1,t=n);var r=Math.random(),i=t-e;return~~(i*r+e)}function bi(e){var t=0;return e||(t=2e3),wi(e,t)}function It(e,t){pe("info","The above "+e+" is totally normal. "+t)}var $t;typeof Object.assign=="function"?$t=Object.assign:$t=function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!=null)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};var Le=$t;class Z extends Error{constructor(t,n,r){super(),this.status=t,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new Z(401,"unauthorized","Name or password is incorrect.");var Si=new Z(400,"bad_request","Missing JSON list of 'docs'"),ge=new Z(404,"not_found","missing"),Fe=new Z(409,"conflict","Document update conflict"),or=new Z(400,"bad_request","_id field must contain a string"),Ai=new Z(412,"missing_id","_id is required for puts"),Oi=new Z(400,"bad_request","Only reserved document ids may start with underscore.");new Z(412,"precondition_failed","Database not open");var nn=new Z(500,"unknown_error","Database encountered an unknown error"),cr=new Z(500,"badarg","Some query argument is invalid");new Z(400,"invalid_request","Request was invalid");var qi=new Z(400,"query_parse_error","Some query parameter is invalid"),Cn=new Z(500,"doc_validation","Bad special document member"),pt=new Z(400,"bad_request","Something wrong with the request"),qt=new Z(400,"bad_request","Document must be a JSON object");new Z(404,"not_found","Database not found");var rn=new Z(500,"indexed_db_went_bad","unknown");new Z(500,"web_sql_went_bad","unknown");new Z(500,"levelDB_went_went_bad","unknown");new Z(403,"forbidden","Forbidden by design doc validate_doc_update function");var fr=new Z(400,"bad_request","Invalid rev format");new Z(412,"file_exists","The database could not be created, the file already exists.");var Ei=new Z(412,"missing_stub","A pre-existing attachment stub wasn't found");new Z(413,"invalid_url","Provided URL is invalid");function J(e,t){function n(r){for(var i=Object.getOwnPropertyNames(e),a=0,o=i.length;a<o;a++)typeof e[i[a]]!="function"&&(this[i[a]]=e[i[a]]);this.stack===void 0&&(this.stack=new Error().stack),r!==void 0&&(this.reason=r)}return n.prototype=Z.prototype,new n(t)}function Ge(e){if(typeof e!="object"){var t=e;e=nn,e.data=t}return"error"in e&&e.error==="conflict"&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=new Error().stack),e}function Ci(e,t,n){try{return!e(t,n)}catch(i){var r="Filter function threw: "+i.toString();return J(pt,r)}}function an(e){var t={},n=e.filter&&typeof e.filter=="function";return t.query=e.query_params,function(i){i.doc||(i.doc={});var a=n&&Ci(e.filter,i.doc,t);if(typeof a=="object")return a;if(a)return!1;if(!e.include_docs)delete i.doc;else if(!e.attachments)for(var o in i.doc._attachments)Object.prototype.hasOwnProperty.call(i.doc._attachments,o)&&(i.doc._attachments[o].stub=!0);return!0}}function ft(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function lr(e){var t;if(e?typeof e!="string"?t=J(or):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=J(Oi)):t=J(Ai),t)throw t}function Oe(e){return typeof e._remote=="boolean"?e._remote:typeof e.type=="function"?(pe("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),e.type()==="http"):!1}function xi(e,t){return"listenerCount"in e?e.listenerCount(t):Ce.listenerCount(e,t)}function Nt(e){if(!e)return null;var t=e.split("/");return t.length===2?t:t.length===1?[e,e]:null}function xn(e){var t=Nt(e);return t?t.join("/"):null}var kn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Tn="queryKey",ki=/(?:^|&)([^&=]*)=?([^&]*)/g,Ti=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function dr(e){for(var t=Ti.exec(e),n={},r=14;r--;){var i=kn[r],a=t[r]||"",o=["user","password"].indexOf(i)!==-1;n[i]=o?decodeURIComponent(a):a}return n[Tn]={},n[kn[12]].replace(ki,function(v,g,_){g&&(n[Tn][g]=_)}),n}function sn(e,t){var n=[],r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function lt(e,t,n){return e.get(t).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,a=n(r);return a?(a._id=t,a._rev=i,Di(e,a,n)):{updated:!1,rev:i}})}function Di(e,t,n){return e.put(t).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return lt(e,t._id,n)})}var un=function(e){return atob(e)},Ye=function(e){return btoa(e)};function on(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if(a.name!=="TypeError")throw a;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(t.type)}}function Pi(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function cn(e,t){return on([Pi(e)],{type:t})}function fn(e,t){return cn(un(e),t)}function Ri(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}function hr(e,t){var n=new FileReader,r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var a=i.target.result||"";if(r)return t(a);t(Ri(a))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function vr(e,t){hr(e,function(n){t(n)})}function ln(e,t){vr(e,function(n){t(Ye(n))})}function Bi(e,t){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);t(i)},n.readAsArrayBuffer(e)}var Li=self.setImmediate||self.setTimeout,ji=32768;function Ii(e){return Ye(e)}function $i(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}function Ni(e,t,n,r,i){(n>0||r<t.size)&&(t=$i(t,n,r)),Bi(t,function(a){e.append(a),i()})}function Mi(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function dn(e,t){var n=typeof e=="string",r=n?e.length:e.size,i=Math.min(ji,r),a=Math.ceil(r/i),o=0,v=n?new Lt:new Lt.ArrayBuffer,g=n?Mi:Ni;function _(){Li(l)}function b(){var p=v.end(!0),y=Ii(p);t(y),v.destroy()}function l(){var p=o*i,y=p+i;o++,o<a?g(v,e,p,y,_):g(v,e,p,y,b)}l()}function gr(e){return Lt.hash(e)}function _r(e,t){if(!t)return tn().replace(/-/g,"").toLowerCase();var n=Le({},e);return delete n._rev_tree,gr(JSON.stringify(n))}var yt=tn;function je(e){for(var t,n,r,i=e.rev_tree.slice(),a;a=i.pop();){var o=a.ids,v=o[2],g=a.pos;if(v.length){for(var _=0,b=v.length;_<b;_++)i.push({pos:g+1,ids:v[_]});continue}var l=!!o[1].deleted,p=o[0];(!t||(r!==l?r:n!==g?n<g:t<p))&&(t=p,n=g,r=l)}return n+"-"+t}function Ie(e,t){for(var n=e.slice(),r;r=n.pop();)for(var i=r.pos,a=r.ids,o=a[2],v=t(o.length===0,i,a[0],r.ctx,a[1]),g=0,_=o.length;g<_;g++)n.push({pos:i+1,ids:o[g],ctx:v})}function Ui(e,t){return e.pos-t.pos}function hn(e){var t=[];Ie(e,function(i,a,o,v,g){i&&t.push({rev:a+"-"+o,pos:a,opts:g})}),t.sort(Ui).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function vn(e){for(var t=je(e),n=hn(e.rev_tree),r=[],i=0,a=n.length;i<a;i++){var o=n[i];o.rev!==t&&!o.opts.deleted&&r.push(o.rev)}return r}function Ki(e){var t=[];return Ie(e.rev_tree,function(n,r,i,a,o){o.status==="available"&&!n&&(t.push(r+"-"+i),o.status="missing")}),t}function Fi(e,t){let n=[];const r=e.slice();let i;for(;i=r.pop();){const{pos:a,ids:o}=i,v=`${a}-${o[0]}`,g=o[2];if(n.push(v),v===t){if(g.length!==0)throw new Error("The requested revision is not a leaf");return n.reverse()}(g.length===0||g.length>1)&&(n=[]);for(let _=0,b=g.length;_<b;_++)r.push({pos:a+1,ids:g[_]})}if(n.length===0)throw new Error("The requested revision does not exist");return n.reverse()}function pr(e){for(var t=[],n=e.slice(),r;r=n.pop();){var i=r.pos,a=r.ids,o=a[0],v=a[1],g=a[2],_=g.length===0,b=r.history?r.history.slice():[];b.push({id:o,opts:v}),_&&t.push({pos:i+1-b.length,ids:b});for(var l=0,p=g.length;l<p;l++)n.push({pos:i+1,ids:g[l],history:b})}return t.reverse()}function Gi(e,t){return e.pos-t.pos}function zi(e,t,n){for(var r=0,i=e.length,a;r<i;)a=r+i>>>1,n(e[a],t)<0?r=a+1:i=a;return r}function Ji(e,t,n){var r=zi(e,t,n);e.splice(r,0,t)}function Dn(e,t){for(var n,r,i=t,a=e.length;i<a;i++){var o=e[i],v=[o.id,o.opts,[]];r?(r[2].push(v),r=v):n=r=v}return n}function Qi(e,t){return e[0]<t[0]?-1:1}function Pn(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),a=i.tree1,o=i.tree2;(a[1].status||o[1].status)&&(a[1].status=a[1].status==="available"||o[1].status==="available"?"available":"missing");for(var v=0;v<o[2].length;v++){if(!a[2][0]){r="new_leaf",a[2][0]=o[2][v];continue}for(var g=!1,_=0;_<a[2].length;_++)a[2][_][0]===o[2][v][0]&&(n.push({tree1:a[2][_],tree2:o[2][v]}),g=!0);g||(r="new_branch",Ji(a[2],o[2][v],Qi))}}return{conflicts:r,tree:e}}function yr(e,t,n){var r=[],i=!1,a=!1,o;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var v=0,g=e.length;v<g;v++){var _=e[v];if(_.pos===t.pos&&_.ids[0]===t.ids[0])o=Pn(_.ids,t.ids),r.push({pos:_.pos,ids:o.tree}),i=i||o.conflicts,a=!0;else if(n!==!0){var b=_.pos<t.pos?_:t,l=_.pos<t.pos?t:_,p=l.pos-b.pos,y=[],w=[];for(w.push({ids:b.ids,diff:p,parent:null,parentIdx:null});w.length>0;){var q=w.pop();if(q.diff===0){q.ids[0]===l.ids[0]&&y.push(q);continue}for(var m=q.ids[2],h=0,d=m.length;h<d;h++)w.push({ids:m[h],diff:q.diff-1,parent:q.ids,parentIdx:h})}var u=y[0];u?(o=Pn(u.ids,l.ids),u.parent[2][u.parentIdx]=o.tree,r.push({pos:b.pos,ids:b.ids}),i=i||o.conflicts,a=!0):r.push(_)}else r.push(_)}return a||r.push(t),r.sort(Gi),{tree:r,conflicts:i||"internal_node"}}function Wi(e,t){for(var n=pr(e),r,i,a=0,o=n.length;a<o;a++){var v=n[a],g=v.ids,_;if(g.length>t){r||(r={});var b=g.length-t;_={pos:v.pos+b,ids:Dn(g,b)};for(var l=0;l<b;l++){var p=v.pos+l+"-"+g[l].id;r[p]=!0}}else _={pos:v.pos,ids:Dn(g,0)};i?i=yr(i,_,!0).tree:i=[_]}return r&&Ie(i,function(y,w,q){delete r[w+"-"+q]}),{tree:i,revs:r?Object.keys(r):[]}}function mr(e,t,n){var r=yr(e,t),i=Wi(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Hi(e,t){for(var n=e.slice(),r=t.split("-"),i=parseInt(r[0],10),a=r[1],o;o=n.pop();){if(o.pos===i&&o.ids[0]===a)return!0;for(var v=o.ids[2],g=0,_=v.length;g<_;g++)n.push({pos:o.pos+1,ids:v[g]})}return!1}function Xi(e){return e.ids}function Ee(e,t){t||(t=je(e));for(var n=t.substring(t.indexOf("-")+1),r=e.rev_tree.map(Xi),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function Be(e){return/^_local/.test(e)}function Yi(e,t){for(var n=t.rev_tree.slice(),r;r=n.pop();){var i=r.pos,a=r.ids,o=a[0],v=a[1],g=a[2],_=g.length===0,b=r.history?r.history.slice():[];if(b.push({id:o,pos:i,opts:v}),_)for(var l=0,p=b.length;l<p;l++){var y=b[l],w=y.pos+"-"+y.id;if(w===e)return i+"-"+o}for(var q=0,m=g.length;q<m;q++)n.push({pos:i+1,ids:g[q],history:b})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function Zi(e,t,n,r){try{e.emit("change",t,n,r)}catch(i){pe("error",'Error in .on("change", function):',i)}}function Vi(e,t,n){var r=[{rev:e._rev}];n.style==="all_docs"&&(r=hn(t.rev_tree).map(function(a){return{rev:a.rev}}));var i={id:t.id,changes:r,doc:e};return Ee(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=vn(t),i.doc._conflicts.length||delete i.doc._conflicts),i}class ea extends Ce{constructor(t,n,r){super(),this.db=t,n=n?ce(n):{};var i=n.complete=ar((v,g)=>{v?xi(this,"error")>0&&this.emit("error",v):this.emit("complete",g),this.removeAllListeners(),t.removeListener("destroyed",a)});r&&(this.on("complete",function(v){r(null,v)}),this.on("error",r));const a=()=>{this.cancel()};t.once("destroyed",a),n.onChange=(v,g,_)=>{this.isCancelled||Zi(this,v,g,_)};var o=new Promise(function(v,g){n.complete=function(_,b){_?g(_):v(b)}});this.once("cancel",function(){t.removeListener("destroyed",a),n.complete(null,{status:"cancelled"})}),this.then=o.then.bind(o),this.catch=o.catch.bind(o),this.then(function(v){i(null,v)},i),t.taskqueue.isReady?this.validateChanges(n):t.taskqueue.addTask(v=>{v?n.complete(v):this.isCancelled?this.emit("cancel"):this.validateChanges(n)})}cancel(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")}validateChanges(t){var n=t.complete;Q._changesFilterPlugin?Q._changesFilterPlugin.validate(t,r=>{if(r)return n(r);this.doChanges(t)}):this.doChanges(t)}doChanges(t){var n=t.complete;if(t=ce(t),"live"in t&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=Vi,t.since==="latest"&&(t.since="now"),t.since||(t.since=0),t.since==="now"){this.db.info().then(i=>{if(this.isCancelled){n(null,{status:"cancelled"});return}t.since=i.update_seq,this.doChanges(t)},n);return}if(Q._changesFilterPlugin){if(Q._changesFilterPlugin.normalize(t),Q._changesFilterPlugin.shouldFilter(this,t))return Q._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(i){i in t&&pe("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=t.limit===0?1:t.limit,t.complete=n;var r=this.db._changes(t);if(r&&typeof r.cancel=="function"){const i=this.cancel;this.cancel=(...a)=>{r.cancel(),i.apply(this,a)}}}}function Rn(e,t){return e<t?-1:e>t?1:0}function Et(e,t){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=t,e(n)):e(null,r.length?r[0]:r)}}function ta(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var a=r[i];n._attachments[a]=Xe(n._attachments[a],["data","digest","content_type","length","revpos","stub"])}}}function na(e,t){var n=Rn(e._id,t._id);if(n!==0)return n;var r=e._revisions?e._revisions.start:0,i=t._revisions?t._revisions.start:0;return Rn(r,i)}function ra(e){var t={},n=[];return Ie(e,function(r,i,a,o){var v=i+"-"+a;return r&&(t[v]=0),o!==void 0&&n.push({from:o,to:v}),v}),n.reverse(),n.forEach(function(r){t[r.from]===void 0?t[r.from]=1+t[r.to]:t[r.from]=Math.min(t[r.from],1+t[r.to])}),t}function ia(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}function wr(e){var t=e._compactionQueue[0],n=t.opts,r=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),e._compact(n,function(a,o){a?r(a):r(null,o),qe(function(){e._compactionQueue.shift(),e._compactionQueue.length&&wr(e)})})})}function aa(e,t,n){return e.get("_local/purges").then(function(r){const i=r.purgeSeq+1;return r.purges.push({docId:t,rev:n,purgeSeq:i}),r.purges.length>self.purged_infos_limit&&r.purges.splice(0,r.purges.length-self.purged_infos_limit),r.purgeSeq=i,r}).catch(function(r){if(r.status!==404)throw r;return{_id:"_local/purges",purges:[{docId:t,rev:n,purgeSeq:0}],purgeSeq:0}}).then(function(r){return e.put(r)})}function sa(e){return e.charAt(0)==="_"?e+" is not a valid attachment name, attachment names cannot start with '_'":!1}class br extends Ce{_setup(){this.post=re("post",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof t!="object"||Array.isArray(t))return r(J(qt));this.bulkDocs({docs:[t]},n,Et(r,t._id))}).bind(this),this.put=re("put",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof t!="object"||Array.isArray(t))return r(J(qt));if(lr(t._id),Be(t._id)&&typeof this._putLocal=="function")return t._deleted?this._removeLocal(t,r):this._putLocal(t,r);const i=o=>{typeof this._put=="function"&&n.new_edits!==!1?this._put(t,n,o):this.bulkDocs({docs:[t]},n,Et(o,t._id))};n.force&&t._rev?(a(),i(function(o){var v=o?null:{ok:!0,id:t._id,rev:t._rev};r(o,v)})):i(r);function a(){var o=t._rev.split("-"),v=o[1],g=parseInt(o[0],10),_=g+1,b=_r();t._revisions={start:_,ids:[b,v]},t._rev=_+"-"+b,n.new_edits=!1}}).bind(this),this.putAttachment=re("putAttachment",function(t,n,r,i,a){var o=this;typeof a=="function"&&(a=i,i=r,r=null),typeof a>"u"&&(a=i,i=r,r=null),a||pe("warn","Attachment",n,"on document",t,"is missing content_type");function v(g){var _="_rev"in g?parseInt(g._rev,10):0;return g._attachments=g._attachments||{},g._attachments[n]={content_type:a,data:i,revpos:++_},o.put(g)}return o.get(t).then(function(g){if(g._rev!==r)throw J(Fe);return v(g)},function(g){if(g.reason===ge.message)return v({_id:t});throw g})}).bind(this),this.removeAttachment=re("removeAttachment",function(t,n,r,i){this.get(t,(a,o)=>{if(a){i(a);return}if(o._rev!==r){i(J(Fe));return}if(!o._attachments)return i();delete o._attachments[n],Object.keys(o._attachments).length===0&&delete o._attachments,this.put(o,i)})}).bind(this),this.remove=re("remove",function(t,n,r,i){var a;typeof n=="string"?(a={_id:t,_rev:n},typeof r=="function"&&(i=r,r={})):(a=t,typeof n=="function"?(i=n,r={}):(i=r,r=n)),r=r||{},r.was_delete=!0;var o={_id:a._id,_rev:a._rev||r.rev};if(o._deleted=!0,Be(o._id)&&typeof this._removeLocal=="function")return this._removeLocal(a,i);this.bulkDocs({docs:[o]},r,Et(i,o._id))}).bind(this),this.revsDiff=re("revsDiff",function(t,n,r){typeof n=="function"&&(r=n,n={});var i=Object.keys(t);if(!i.length)return r(null,{});var a=0,o=new ve;function v(_,b){o.has(_)||o.set(_,{missing:[]}),o.get(_).missing.push(b)}function g(_,b){var l=t[_].slice(0);Ie(b,function(p,y,w,q,m){var h=y+"-"+w,d=l.indexOf(h);d!==-1&&(l.splice(d,1),m.status!=="available"&&v(_,h))}),l.forEach(function(p){v(_,p)})}i.map(function(_){this._getRevisionTree(_,function(b,l){if(b&&b.status===404&&b.message==="missing")o.set(_,{missing:t[_]});else{if(b)return r(b);g(_,l)}if(++a===i.length){var p={};return o.forEach(function(y,w){p[w]=y}),r(null,p)}})},this)}).bind(this),this.bulkGet=re("bulkGet",function(t,n){ur(this,t,n)}).bind(this),this.compactDocument=re("compactDocument",function(t,n,r){this._getRevisionTree(t,(i,a)=>{if(i)return r(i);var o=ra(a),v=[],g=[];Object.keys(o).forEach(function(_){o[_]>n&&v.push(_)}),Ie(a,function(_,b,l,p,y){var w=b+"-"+l;y.status==="available"&&v.indexOf(w)!==-1&&g.push(w)}),this._doCompaction(t,g,r)})}).bind(this),this.compact=re("compact",function(t,n){typeof t=="function"&&(n=t,t={}),t=t||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:t,callback:n}),this._compactionQueue.length===1&&wr(this)}).bind(this),this.get=re("get",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof t!="string")return r(J(or));if(Be(t)&&typeof this._getLocal=="function")return this._getLocal(t,r);var i=[];const a=()=>{var g=[],_=i.length;if(!_)return r(null,g);i.forEach(b=>{this.get(t,{rev:b,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(l,p){if(l)g.push({missing:b});else{for(var y,w=0,q=g.length;w<q;w++)if(g[w].ok&&g[w].ok._rev===p._rev){y=!0;break}y||g.push({ok:p})}_--,_||r(null,g)})})};if(n.open_revs){if(n.open_revs==="all")this._getRevisionTree(t,function(g,_){if(g)return r(g);i=hn(_).map(function(b){return b.rev}),a()});else if(Array.isArray(n.open_revs)){i=n.open_revs;for(var o=0;o<i.length;o++){var v=i[o];if(!(typeof v=="string"&&/^\d+-/.test(v)))return r(J(fr))}a()}else return r(J(nn,"function_clause"));return}return this._get(t,n,(g,_)=>{if(g)return g.docId=t,r(g);var b=_.doc,l=_.metadata,p=_.ctx;if(n.conflicts){var y=vn(l);y.length&&(b._conflicts=y)}if(Ee(l,b._rev)&&(b._deleted=!0),n.revs||n.revs_info){for(var w=b._rev.split("-"),q=parseInt(w[0],10),m=w[1],h=pr(l.rev_tree),d=null,u=0;u<h.length;u++){var s=h[u],c=s.ids.map(function(K){return K.id}).indexOf(m),f=c===q-1;(f||!d&&c!==-1)&&(d=s)}if(!d)return g=new Error("invalid rev tree"),g.docId=t,r(g);var O=d.ids.map(function(K){return K.id}).indexOf(b._rev.split("-")[1])+1,E=d.ids.length-O;if(d.ids.splice(O,E),d.ids.reverse(),n.revs&&(b._revisions={start:d.pos+d.ids.length-1,ids:d.ids.map(function(K){return K.id})}),n.revs_info){var C=d.pos+d.ids.length;b._revs_info=d.ids.map(function(K){return C--,{rev:C+"-"+K.id,status:K.opts.status}})}}if(n.attachments&&b._attachments){var P=b._attachments,j=Object.keys(P).length;if(j===0)return r(null,b);Object.keys(P).forEach(K=>{this._getAttachment(b._id,K,P[K],{rev:b._rev,binary:n.binary,ctx:p},function(N,G){var z=b._attachments[K];z.data=G,delete z.stub,delete z.length,--j||r(null,b)})})}else{if(b._attachments)for(var U in b._attachments)Object.prototype.hasOwnProperty.call(b._attachments,U)&&(b._attachments[U].stub=!0);r(null,b)}})}).bind(this),this.getAttachment=re("getAttachment",function(t,n,r,i){r instanceof Function&&(i=r,r={}),this._get(t,r,(a,o)=>{if(a)return i(a);if(o.doc._attachments&&o.doc._attachments[n])r.ctx=o.ctx,r.binary=!0,this._getAttachment(t,n,o.doc._attachments[n],r,i);else return i(J(ge))})}).bind(this),this.allDocs=re("allDocs",function(t,n){if(typeof t=="function"&&(n=t,t={}),t.skip=typeof t.skip<"u"?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return n(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(i){return i in t})[0];if(r){n(J(qi,"Query parameter `"+r+"` is not compatible with multi-get"));return}if(!Oe(this)&&(ia(t),t.keys.length===0))return this._allDocs({limit:0},n)}return this._allDocs(t,n)}).bind(this),this.close=re("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}).bind(this),this.info=re("info",function(t){this._info((n,r)=>{if(n)return t(n);r.db_name=r.db_name||this.name,r.auto_compaction=!!(this.auto_compaction&&!Oe(this)),r.adapter=this.adapter,t(null,r)})}).bind(this),this.id=re("id",function(t){return this._id(t)}).bind(this),this.bulkDocs=re("bulkDocs",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return r(J(Si));for(var i=0;i<t.docs.length;++i)if(typeof t.docs[i]!="object"||Array.isArray(t.docs[i]))return r(J(qt));var a;if(t.docs.forEach(function(g){g._attachments&&Object.keys(g._attachments).forEach(function(_){a=a||sa(_),g._attachments[_].content_type||pe("warn","Attachment",_,"on document",g._id,"is missing content_type")})}),a)return r(J(pt,a));"new_edits"in n||("new_edits"in t?n.new_edits=t.new_edits:n.new_edits=!0);var o=this;!n.new_edits&&!Oe(o)&&t.docs.sort(na),ta(t.docs);var v=t.docs.map(function(g){return g._id});this._bulkDocs(t,n,function(g,_){if(g)return r(g);if(n.new_edits||(_=_.filter(function(p){return p.error})),!Oe(o))for(var b=0,l=_.length;b<l;b++)_[b].id=_[b].id||v[b];r(null,_)})}).bind(this),this.registerDependentDatabase=re("registerDependentDatabase",function(t,n){var r=ce(this.__opts);this.__opts.view_adapter&&(r.adapter=this.__opts.view_adapter);var i=new this.constructor(t,r);function a(o){return o.dependentDbs=o.dependentDbs||{},o.dependentDbs[t]?!1:(o.dependentDbs[t]=!0,o)}lt(this,"_local/_pouch_dependentDbs",a).then(function(){n(null,{db:i})}).catch(n)}).bind(this),this.destroy=re("destroy",function(t,n){typeof t=="function"&&(n=t,t={});var r="use_prefix"in this?this.use_prefix:!0;const i=()=>{this._destroy(t,(a,o)=>{if(a)return n(a);this._destroyed=!0,this.emit("destroyed"),n(null,o||{ok:!0})})};if(Oe(this))return i();this.get("_local/_pouch_dependentDbs",(a,o)=>{if(a)return a.status!==404?n(a):i();var v=o.dependentDbs,g=this.constructor,_=Object.keys(v).map(b=>{var l=r?b.replace(new RegExp("^"+g.prefix),""):b;return new g(l,this.__opts).destroy()});Promise.all(_).then(i,n)})}).bind(this)}_compact(t,n){var r={return_docs:!1,last_seq:t.last_seq||0},i=[],a,o=0;const v=b=>{this.activeTasks.update(a,{completed_items:++o}),i.push(this.compactDocument(b.id,0))},g=b=>{this.activeTasks.remove(a,b),n(b)},_=b=>{var l=b.last_seq;Promise.all(i).then(()=>lt(this,"_local/compaction",p=>!p.last_seq||p.last_seq<l?(p.last_seq=l,p):!1)).then(()=>{this.activeTasks.remove(a),n(null,{ok:!0})}).catch(g)};this.info().then(b=>{a=this.activeTasks.add({name:"database_compaction",total_items:b.update_seq-r.last_seq}),this.changes(r).on("change",v).on("complete",_).on("error",g)})}changes(t,n){return typeof t=="function"&&(n=t,t={}),t=t||{},t.return_docs="return_docs"in t?t.return_docs:!t.live,new ea(this,t,n)}type(){return typeof this._type=="function"?this._type():this.adapter}}br.prototype.purge=re("_purge",function(e,t,n){if(typeof this._purge>"u")return n(J(nn,"Purge is not implemented in the "+this.adapter+" adapter."));var r=this;r._getRevisionTree(e,(i,a)=>{if(i)return n(i);if(!a)return n(J(ge));let o;try{o=Fi(a,t)}catch(v){return n(v.message||v)}r._purge(e,o,(v,g)=>{if(v)return n(v);aa(r,e,t).then(function(){return n(null,g)})})})});class ua{constructor(){this.isReady=!1,this.failed=!1,this.queue=[]}execute(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()}fail(t){this.failed=t,this.execute()}ready(t){this.isReady=!0,this.db=t,this.execute()}addTask(t){this.queue.push(t),this.failed&&this.execute()}}function oa(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=Q.adapters,i=Q.preferredAdapters,a=Q.prefix,o=t.adapter;if(!o)for(var v=0;v<i.length;++v){if(o=i[v],o==="idb"&&"websql"in r&&ct()&&localStorage["_pouch__websqldb_"+a+e]){pe("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var g=r[o],_=g&&"use_prefix"in g?g.use_prefix:!0;return{name:_?a+e:e,adapter:o}}function ca(e,t){e.prototype=Object.create(t.prototype,{constructor:{value:e}})}function Sr(e,t){let n=function(...r){if(!(this instanceof n))return new n(...r);t.apply(this,r)};return ca(n,e),n}function fa(e){function t(r){e.removeListener("closed",n),r||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)}class Bn extends br{constructor(t,n){super(),this._setup(t,n)}_setup(t,n){if(super._setup(),n=n||{},t&&typeof t=="object"&&(n=t,t=n.name,delete n.name),n.deterministic_revs===void 0&&(n.deterministic_revs=!0),this.__opts=n=ce(n),this.auto_compaction=n.auto_compaction,this.purged_infos_limit=n.purged_infos_limit||1e3,this.prefix=Q.prefix,typeof t!="string")throw new Error("Missing/invalid DB name");var r=(n.prefix||"")+t,i=oa(r,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,this.name=t,this._adapter=n.adapter,Q.emit("debug",["adapter","Picked adapter: ",n.adapter]),!Q.adapters[n.adapter]||!Q.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);if(n.view_adapter&&(!Q.adapters[n.view_adapter]||!Q.adapters[n.view_adapter].valid()))throw new Error("Invalid View Adapter: "+n.view_adapter);this.taskqueue=new ua,this.adapter=n.adapter,Q.adapters[n.adapter].call(this,n,a=>{if(a)return this.taskqueue.fail(a);fa(this),this.emit("created",this),Q.emit("created",this.name),this.taskqueue.ready(this)})}}const Q=Sr(Bn,function(e,t){Bn.prototype._setup.call(this,e,t)});var la=typeof AbortController<"u"?AbortController:function(){return{abort:function(){}}},Ar=fetch,Me=Headers;class da{constructor(){this.tasks={}}list(){return Object.values(this.tasks)}add(t){const n=tn();return this.tasks[n]={id:n,name:t.name,total_items:t.total_items,created_at:new Date().toJSON()},n}get(t){return this.tasks[t]}remove(t,n){return delete this.tasks[t],this.tasks}update(t,n){const r=this.tasks[t];if(typeof r<"u"){const i={id:r.id,name:r.name,created_at:r.created_at,total_items:n.total_items||r.total_items,completed_items:n.completed_items||r.completed_items,updated_at:new Date().toJSON()};this.tasks[t]=i}return this.tasks}}Q.adapters={};Q.preferredAdapters=[];Q.prefix="_pouch_";var Ln=new Ce;function ha(e){Object.keys(Ce.prototype).forEach(function(n){typeof Ce.prototype[n]=="function"&&(e[n]=Ln[n].bind(Ln))});var t=e._destructionListeners=new ve;e.on("ref",function(r){t.has(r.name)||t.set(r.name,[]),t.get(r.name).push(r)}),e.on("unref",function(r){if(t.has(r.name)){var i=t.get(r.name),a=i.indexOf(r);a<0||(i.splice(a,1),i.length>1?t.set(r.name,i):t.delete(r.name))}}),e.on("destroyed",function(r){if(t.has(r)){var i=t.get(r);t.delete(r),i.forEach(function(a){a.emit("destroyed",!0)})}})}ha(Q);Q.adapter=function(e,t,n){t.valid()&&(Q.adapters[e]=t,n&&Q.preferredAdapters.push(e))};Q.plugin=function(e){if(typeof e=="function")e(Q);else{if(typeof e!="object"||Object.keys(e).length===0)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){Q.prototype[t]=e[t]})}return this.__defaults&&(Q.__defaults=Le({},this.__defaults)),Q};Q.defaults=function(e){let t=Sr(Q,function(n,r){r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=Le({},t.__defaults,r),Q.call(this,n,r)});return t.preferredAdapters=Q.preferredAdapters.slice(),Object.keys(Q).forEach(function(n){n in t||(t[n]=Q[n])}),t.__defaults=Le({},this.__defaults,e),t};Q.fetch=function(e,t){return Ar(e,t)};Q.prototype.activeTasks=Q.activeTasks=new da;var va="8.0.1";function gn(e,t){for(var n=e,r=0,i=t.length;r<i;r++){var a=t[r];if(n=n[a],!n)break}return n}function ga(e,t){return e<t?-1:e>t?1:0}function _n(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var a=e[r];r>0&&e[r-1]==="\\"&&(a==="$"||a===".")?n=n.substring(0,n.length-1)+a:a==="."?(t.push(n),n=""):n+=a}return t.push(n),t}var _a=["$or","$nor","$not"];function Or(e){return _a.indexOf(e)>-1}function qr(e){return Object.keys(e)[0]}function pa(e){return e[qr(e)]}function We(e){var t={},n={$or:!0,$nor:!0};return e.forEach(function(r){Object.keys(r).forEach(function(i){var a=r[i];if(typeof a!="object"&&(a={$eq:a}),Or(i))if(a instanceof Array){if(n[i]){n[i]=!1,t[i]=a;return}var o=[];t[i].forEach(function(g){Object.keys(a).forEach(function(_){var b=a[_],l=Math.max(Object.keys(g).length,Object.keys(b).length),p=We([g,b]);Object.keys(p).length<=l||o.push(p)})}),t[i]=o}else t[i]=We([a]);else{var v=t[i]=t[i]||{};Object.keys(a).forEach(function(g){var _=a[g];if(g==="$gt"||g==="$gte")return ya(g,_,v);if(g==="$lt"||g==="$lte")return ma(g,_,v);if(g==="$ne")return wa(_,v);if(g==="$eq")return ba(_,v);if(g==="$regex")return Sa(_,v);v[g]=_})}})}),t}function ya(e,t,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?e==="$gte"?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):typeof n.$gt<"u"?e==="$gte"?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t)}function ma(e,t,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?e==="$lte"?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):typeof n.$lt<"u"?e==="$lte"?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t)}function wa(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function ba(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function Sa(e,t){"$regex"in t?t.$regex.push(e):t.$regex=[e]}function Er(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=We(e[n].$and));var r=e[t];typeof r=="object"&&Er(r)}return e}function Cr(e,t){for(var n in e){n==="$and"&&(t=!0);var r=e[n];typeof r=="object"&&(t=Cr(r,t))}return t}function Aa(e){var t=ce(e);Cr(t,!1)&&(t=Er(t),"$and"in t&&(t=We(t.$and))),["$or","$nor"].forEach(function(o){o in t&&t[o].forEach(function(v){for(var g=Object.keys(v),_=0;_<g.length;_++){var b=g[_],l=v[b];(typeof l!="object"||l===null)&&(v[b]={$eq:l})}})}),"$not"in t&&(t.$not=We([t.$not]));for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r],a=t[i];(typeof a!="object"||a===null)&&(a={$eq:a}),t[i]=a}return Mt(t),t}function Mt(e){Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&Mt(r)}):t==="$ne"?e.$ne=[n]:t==="$regex"?e.$regex=[n]:n&&typeof n=="object"&&Mt(n)})}function Oa(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}function qa(e,t,n){var r=Oa(e,t,n);return r+e}var xr=-324,Ut=3,Kt="";function ie(e,t){if(e===t)return 0;e=$e(e),t=$e(t);var n=Ft(e),r=Ft(t);if(n-r!==0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return Da(e,t)}return Array.isArray(e)?Ta(e,t):Pa(e,t)}function $e(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=$e(t[r])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i];typeof a<"u"&&(e[i]=$e(a))}}}}return e}function Ea(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return Ra(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,a="";if(t)for(;++r<i;)a+=ye(n[r]);else for(;++r<i;){var o=n[r];a+=ye(o)+ye(e[o])}return a}return""}function ye(e){var t="\0";return e=$e(e),Ft(e)+Kt+Ea(e)+t}function Ca(e,t){var n=t,r,i=e[t]==="1";if(i)r=0,t++;else{var a=e[t]==="0";t++;var o="",v=e.substring(t,t+Ut),g=parseInt(v,10)+xr;for(a&&(g=-g),t+=Ut;;){var _=e[t];if(_==="\0")break;o+=_,t++}o=o.split("."),o.length===1?r=parseInt(o,10):r=parseFloat(o[0]+"."+o[1]),a&&(r=r-10),g!==0&&(r=parseFloat(r+"e"+g))}return{num:r,length:t-n}}function xa(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,a=r.index;if(Array.isArray(i))i.push(n);else if(a===e.length-2){var o=e.pop();i[o]=n}else e.push(n)}}function ka(e){for(var t=[],n=[],r=0;;){var i=e[r++];if(i==="\0"){if(t.length===1)return t.pop();xa(t,n);continue}switch(i){case"1":t.push(null);break;case"2":t.push(e[r]==="1"),r++;break;case"3":var a=Ca(e,r);t.push(a.num),r+=a.length;break;case"4":for(var o="";;){var v=e[r];if(v==="\0")break;o+=v,r++}o=o.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(o);break;case"5":var g={element:[],index:t.length};t.push(g.element),n.push(g);break;case"6":var _={element:{},index:t.length};t.push(_.element),n.push(_);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function Ta(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=ie(e[r],t[r]);if(i!==0)return i}return e.length===t.length?0:e.length>t.length?1:-1}function Da(e,t){return e===t?0:e>t?1:-1}function Pa(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),a=0;a<i;a++){var o=ie(n[a],r[a]);if(o!==0||(o=ie(e[n[a]],t[r[a]]),o!==0))return o}return n.length===r.length?0:n.length>r.length?1:-1}function Ft(e){var t=["boolean","number","string","object"],n=t.indexOf(typeof e);if(~n)return e===null?1:Array.isArray(e)?5:n<3?n+2:n+3;if(Array.isArray(e))return 5}function Ra(e){if(e===0)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",a=(r?-n:n)-xr,o=qa(a.toString(),"0",Ut);i+=Kt+o;var v=Math.abs(parseFloat(t[0]));r&&(v=10-v);var g=v.toFixed(20);return g=g.replace(/\.?0+$/,""),i+=Kt+g,i}function Ba(e){function t(n){return e.map(function(r){var i=qr(r),a=_n(i),o=gn(n,a);return o})}return function(n,r){var i=t(n.doc),a=t(r.doc),o=ie(i,a);return o!==0?o:ga(n.doc._id,r.doc._id)}}function La(e,t,n){if(e=e.filter(function(o){return Ue(o.doc,t.selector,n)}),t.sort){var r=Ba(t.sort);e=e.sort(r),typeof t.sort[0]!="string"&&pa(t.sort[0])==="desc"&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,a=("limit"in t?t.limit:e.length)+i;e=e.slice(i,a)}return e}function Ue(e,t,n){return n.every(function(r){var i=t[r],a=_n(r),o=gn(e,a);return Or(r)?ja(r,i,e):dt(i,e,a,o)})}function dt(e,t,n,r){return e?typeof e=="object"?Object.keys(e).every(function(i){var a=e[i];if(i.indexOf("$")===0)return jn(i,t,a,n,r);var o=_n(i);if(r===void 0&&typeof a!="object"&&o.length>0)return!1;var v=gn(r,o);return typeof a=="object"?dt(a,t,n,v):jn("$eq",t,a,o,v)}):e===r:!0}function ja(e,t,n){return e==="$or"?t.some(function(r){return Ue(n,r,Object.keys(r))}):e==="$not"?!Ue(n,t,Object.keys(t)):!t.find(function(r){return Ue(n,r,Object.keys(r))})}function jn(e,t,n,r,i){if(!$n[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return $n[e](t,n,r,i)}function Je(e){return typeof e<"u"&&e!==null}function ke(e){return typeof e<"u"}function Ia(e,t){if(typeof e!="number"||parseInt(e,10)!==e)return!1;var n=t[0],r=t[1];return e%n===r}function In(e,t){return t.some(function(n){return e instanceof Array?e.some(function(r){return ie(n,r)===0}):ie(n,e)===0})}function $a(e,t){return t.every(function(n){return e.some(function(r){return ie(n,r)===0})})}function Na(e,t){return e.length===t}function Ma(e,t){var n=new RegExp(t);return n.test(e)}function Ua(e,t){switch(t){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}}var $n={$elemMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return Ue(i,t,Object.keys(t))}):r.some(function(i){return dt(t,e,n,i)})},$allMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return Ue(i,t,Object.keys(t))}):r.every(function(i){return dt(t,e,n,i)})},$eq:function(e,t,n,r){return ke(r)&&ie(r,t)===0},$gte:function(e,t,n,r){return ke(r)&&ie(r,t)>=0},$gt:function(e,t,n,r){return ke(r)&&ie(r,t)>0},$lte:function(e,t,n,r){return ke(r)&&ie(r,t)<=0},$lt:function(e,t,n,r){return ke(r)&&ie(r,t)<0},$exists:function(e,t,n,r){return t?ke(r):!ke(r)},$mod:function(e,t,n,r){return Je(r)&&Ia(r,t)},$ne:function(e,t,n,r){return t.every(function(i){return ie(r,i)!==0})},$in:function(e,t,n,r){return Je(r)&&In(r,t)},$nin:function(e,t,n,r){return Je(r)&&!In(r,t)},$size:function(e,t,n,r){return Je(r)&&Array.isArray(r)&&Na(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&$a(r,t)},$regex:function(e,t,n,r){return Je(r)&&typeof r=="string"&&t.every(function(i){return Ma(r,i)})},$type:function(e,t,n,r){return Ua(r,t)}};function Ka(e,t){if(typeof t!="object")throw new Error("Selector error: expected a JSON object");t=Aa(t);var n={doc:e},r=La([n],{selector:t},Object.keys(t));return r&&r.length===1}function Fa(e){return sn(`"use strict";
return `+e+";",{})}function Ga(e){var t=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return sn(t,{})}function za(e,t){if(e.selector&&e.filter&&e.filter!=="_selector"){var n=typeof e.filter=="string"?e.filter:"function";return t(new Error('selector invalid for filter "'+n+'"'))}t()}function Ja(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&typeof e.filter=="string"&&(e.filter==="_view"?e.view=xn(e.view):e.filter=xn(e.filter))}function Qa(e,t){return t.filter&&typeof t.filter=="string"&&!t.doc_ids&&!Oe(e.db)}function Wa(e,t){var n=t.complete;if(t.filter==="_view"){if(!t.view||typeof t.view!="string"){var r=J(pt,"`view` filter parameter not found or invalid.");return n(r)}var i=Nt(t.view);e.db.get("_design/"+i[0],function(o,v){if(e.isCancelled)return n(null,{status:"cancelled"});if(o)return n(Ge(o));var g=v&&v.views&&v.views[i[1]]&&v.views[i[1]].map;if(!g)return n(J(ge,v.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=Ga(g),e.doChanges(t)})}else if(t.selector)t.filter=function(o){return Ka(o,t.selector)},e.doChanges(t);else{var a=Nt(t.filter);e.db.get("_design/"+a[0],function(o,v){if(e.isCancelled)return n(null,{status:"cancelled"});if(o)return n(Ge(o));var g=v&&v.filters&&v.filters[a[1]];if(!g)return n(J(ge,v&&v.filters?"missing json key: "+a[1]:"missing json key: filters"));t.filter=Fa(g),e.doChanges(t)})}}function Ha(e){e._changesFilterPlugin={validate:za,normalize:Ja,shouldFilter:Qa,filter:Wa}}Q.plugin(Ha);Q.version=va;function kr(e){return e.reduce(function(t,n){return t[n]=!0,t},{})}var Xa=kr(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Ya=kr(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Nn(e){if(!/^\d+-/.test(e))return J(fr);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function Za(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],a=1,o=r.length;a<o;a++)i=[r[a],{status:"missing"},[i]];return[{pos:n,ids:i}]}function Tr(e,t,n){n||(n={deterministic_revs:!0});var r,i,a,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=yt()),i=_r(e,n.deterministic_revs),e._rev){if(a=Nn(e._rev),a.error)return a;e._rev_tree=[{pos:a.prefix,ids:[a.id,{status:"missing"},[[i,o,[]]]]}],r=a.prefix+1}else e._rev_tree=[{pos:1,ids:[i,o,[]]}],r=1;else if(e._revisions&&(e._rev_tree=Za(e._revisions,o),r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if(a=Nn(e._rev),a.error)return a;r=a.prefix,i=a.id,e._rev_tree=[{pos:r,ids:[i,o,[]]}]}lr(e._id),e._rev=r+"-"+i;var v={metadata:{},data:{}};for(var g in e)if(Object.prototype.hasOwnProperty.call(e,g)){var _=g[0]==="_";if(_&&!Xa[g]){var b=J(Cn,g);throw b.message=Cn.message+": "+g,b}else _&&!Ya[g]?v.metadata[g.slice(1)]=e[g]:v.data[g]=e[g]}return v}function Va(e){try{return un(e)}catch{var t=J(cr,"Attachment is not a valid base64 string");return{error:t}}}function es(e,t,n){var r=Va(e.data);if(r.error)return n(r.error);e.length=r.length,t==="blob"?e.data=cn(r,e.content_type):t==="base64"?e.data=Ye(r):e.data=r,dn(r,function(i){e.digest="md5-"+i,n()})}function ts(e,t,n){dn(e.data,function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,t==="binary"?vr(e.data,function(i){e.data=i,n()}):t==="base64"?ln(e.data,function(i){e.data=i,n()}):n()})}function ns(e,t,n){if(e.stub)return n();typeof e.data=="string"?es(e,t,n):ts(e,t,n)}function rs(e,t,n){if(!e.length)return n();var r=0,i;e.forEach(function(o){var v=o.data&&o.data._attachments?Object.keys(o.data._attachments):[],g=0;if(!v.length)return a();function _(l){i=l,g++,g===v.length&&a()}for(var b in o.data._attachments)Object.prototype.hasOwnProperty.call(o.data._attachments,b)&&ns(o.data._attachments[b],t,_)});function a(){r++,e.length===r&&(i?n(i):n())}}function is(e,t,n,r,i,a,o,v){if(Hi(t.rev_tree,n.metadata.rev)&&!v)return r[i]=n,a();var g=t.winningRev||je(t),_="deleted"in t?t.deleted:Ee(t,g),b="deleted"in n.metadata?n.metadata.deleted:Ee(n.metadata),l=/^1-/.test(n.metadata.rev);if(_&&!b&&v&&l){var p=n.data;p._rev=g,p._id=n.metadata.id,n=Tr(p,v)}var y=mr(t.rev_tree,n.metadata.rev_tree[0],e),w=v&&(_&&b&&y.conflicts!=="new_leaf"||!_&&y.conflicts!=="new_leaf"||_&&!b&&y.conflicts==="new_branch");if(w){var q=J(Fe);return r[i]=q,a()}var m=n.metadata.rev;n.metadata.rev_tree=y.tree,n.stemmedRevs=y.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var h=je(n.metadata),d=Ee(n.metadata,h),u=_===d?0:_<d?-1:1,s;m===h?s=d:s=Ee(n.metadata,m),o(n,h,d,s,!0,u,i,a)}function as(e){return e.metadata.rev_tree[0].ids[1].status==="missing"}function ss(e,t,n,r,i,a,o,v,g){e=e||1e3;function _(q,m,h){var d=je(q.metadata),u=Ee(q.metadata,d);if("was_delete"in v&&u)return a[m]=J(ge,"deleted"),h();var s=b&&as(q);if(s){var c=J(Fe);return a[m]=c,h()}var f=u?0:1;o(q,d,u,u,!1,f,m,h)}var b=v.new_edits,l=new ve,p=0,y=t.length;function w(){++p===y&&g&&g()}t.forEach(function(q,m){if(q._id&&Be(q._id)){var h=q._deleted?"_removeLocal":"_putLocal";n[h](q,{ctx:i},function(u,s){a[m]=u||s,w()});return}var d=q.metadata.id;l.has(d)?(y--,l.get(d).push([q,m])):l.set(d,[[q,m]])}),l.forEach(function(q,m){var h=0;function d(){++h<q.length?u():w()}function u(){var s=q[h],c=s[0],f=s[1];if(r.has(m))is(e,r.get(m),c,a,f,d,o,b);else{var O=mr([],c.metadata.rev_tree[0],e);c.metadata.rev_tree=O.tree,c.stemmedRevs=O.stemmedRevs||[],_(c,f,d)}}u()})}var us=5,ue="document-store",le="by-sequence",_e="attach-store",Pe="attach-seq-store",de="meta-store",be="local-store",Gt="detect-blob-support";function os(e){try{return JSON.parse(e)}catch{return nr.parse(e)}}function cs(e){try{return JSON.stringify(e)}catch{return nr.stringify(e)}}function Ae(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(J(rn,n,t.type))}}function zt(e,t,n){return{data:cs(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Re(e){if(!e)return null;var t=os(e.data);return t.winningRev=e.winningRev,t.deleted=e.deletedOrLocal==="1",t.seq=e.seq,t}function ht(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function Dr(e,t,n,r){n?r(e?typeof e!="string"?e:fn(e,t):on([""],{type:t})):e?typeof e!="string"?hr(e,function(i){r(Ye(i))}):r(e):r("")}function Pr(e,t,n,r){var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var a=0;function o(){++a===i.length&&r&&r()}function v(g,_){var b=g._attachments[_],l=b.digest,p=n.objectStore(_e).get(l);p.onsuccess=function(y){b.body=y.target.result.body,o()}}i.forEach(function(g){t.attachments&&t.include_docs?v(e,g):(e._attachments[g].stub=!0,o())})}function Jt(e,t){return Promise.all(e.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var a=n.doc._attachments[i];if("body"in a){var o=a.body,v=a.content_type;return new Promise(function(g){Dr(o,v,t,function(_){n.doc._attachments[i]=Le(Xe(a,["digest","content_type"]),{data:_}),g()})})}}))}}))}function Rr(e,t,n){var r=[],i=n.objectStore(le),a=n.objectStore(_e),o=n.objectStore(Pe),v=e.length;function g(){v--,v||_()}function _(){r.length&&r.forEach(function(b){var l=o.index("digestSeq").count(IDBKeyRange.bound(b+"::",b+"::",!1,!1));l.onsuccess=function(p){var y=p.target.result;y||a.delete(b)}})}e.forEach(function(b){var l=i.index("_doc_id_rev"),p=t+"::"+b;l.getKey(p).onsuccess=function(y){var w=y.target.result;if(typeof w!="number")return g();i.delete(w);var q=o.index("seq").openCursor(IDBKeyRange.only(w));q.onsuccess=function(m){var h=m.target.result;if(h){var d=h.value.digestSeq.split("::")[0];r.push(d),o.delete(h.primaryKey),h.continue()}else g()}}})}function me(e,t,n){try{return{txn:e.transaction(t,n)}}catch(r){return{error:r}}}var Qe=new mi;function fs(e,t,n,r,i,a){for(var o=t.docs,v,g,_,b,l,p,y,w,q=0,m=o.length;q<m;q++){var h=o[q];h._id&&Be(h._id)||(h=o[q]=Tr(h,n.new_edits,e),h.error&&!y&&(y=h))}if(y)return a(y);var d=!1,u=0,s=new Array(o.length),c=new ve,f=!1,O=r._meta.blobSupport?"blob":"base64";rs(o,O,function(k){if(k)return a(k);E()});function E(){var k=[ue,le,_e,be,Pe,de],R=me(i,k,"readwrite");if(R.error)return a(R.error);v=R.txn,v.onabort=Ae(a),v.ontimeout=Ae(a),v.oncomplete=K,g=v.objectStore(ue),_=v.objectStore(le),b=v.objectStore(_e),l=v.objectStore(Pe),p=v.objectStore(de),p.get(de).onsuccess=function(I){w=I.target.result,j()},G(function(I){if(I)return f=!0,a(I);U()})}function C(){d=!0,j()}function P(){ss(e.revs_limit,o,r,c,v,s,z,n,C)}function j(){!w||!d||(w.docCount+=u,p.put(w))}function U(){if(!o.length)return;var k=0;function R(){++k===o.length&&P()}function I(B){var $=Re(B.target.result);$&&c.set($.id,$),R()}for(var F=0,L=o.length;F<L;F++){var x=o[F];if(x._id&&Be(x._id)){R();continue}var T=g.get(x.metadata.id);T.onsuccess=I}}function K(){f||(Qe.notify(r._meta.name),a(null,s))}function N(k,R){var I=b.get(k);I.onsuccess=function(F){if(F.target.result)R();else{var L=J(Ei,"unknown stub attachment with digest "+k);L.status=412,R(L)}}}function G(k){var R=[];if(o.forEach(function(x){x.data&&x.data._attachments&&Object.keys(x.data._attachments).forEach(function(T){var B=x.data._attachments[T];B.stub&&R.push(B.digest)})}),!R.length)return k();var I=0,F;function L(){++I===R.length&&k(F)}R.forEach(function(x){N(x,function(T){T&&!F&&(F=T),L()})})}function z(k,R,I,F,L,x,T,B){k.metadata.winningRev=R,k.metadata.deleted=I;var $=k.data;$._id=k.metadata.id,$._rev=k.metadata.rev,F&&($._deleted=!0);var M=$._attachments&&Object.keys($._attachments).length;if(M)return S(k,R,I,L,T,B);u+=x,j(),W(k,R,I,L,T,B)}function W(k,R,I,F,L,x){var T=k.data,B=k.metadata;T._doc_id_rev=B.id+"::"+B.rev,delete T._id,delete T._rev;function $(ae){var he=k.stemmedRevs||[];F&&r.auto_compaction&&(he=he.concat(Ki(k.metadata))),he&&he.length&&Rr(he,k.metadata.id,v),B.seq=ae.target.result;var we=zt(B,R,I),H=g.put(we);H.onsuccess=X}function M(ae){ae.preventDefault(),ae.stopPropagation();var he=_.index("_doc_id_rev"),we=he.getKey(T._doc_id_rev);we.onsuccess=function(H){var Y=_.put(T,H.target.result);Y.onsuccess=$}}function X(){s[L]={ok:!0,id:B.id,rev:B.rev},c.set(k.metadata.id,k.metadata),A(k,B.seq,x)}var V=_.put(T);V.onsuccess=$,V.onerror=M}function S(k,R,I,F,L,x){var T=k.data,B=0,$=Object.keys(T._attachments);function M(){B===$.length&&W(k,R,I,F,L,x)}function X(){B++,M()}$.forEach(function(V){var ae=k.data._attachments[V];if(ae.stub)B++,M();else{var he=ae.data;delete ae.data,ae.revpos=parseInt(R,10);var we=ae.digest;D(we,he,X)}})}function A(k,R,I){var F=0,L=Object.keys(k.data._attachments||{});if(!L.length)return I();function x(){++F===L.length&&I()}function T($){var M=k.data._attachments[$].digest,X=l.put({seq:R,digestSeq:M+"::"+R});X.onsuccess=x,X.onerror=function(V){V.preventDefault(),V.stopPropagation(),x()}}for(var B=0;B<L.length;B++)T(L[B])}function D(k,R,I){var F=b.count(k);F.onsuccess=function(L){var x=L.target.result;if(x)return I();var T={digest:k,body:R},B=b.put(T);B.onsuccess=I}}}function Br(e,t,n,r,i){r===-1&&(r=1e3);var a=typeof e.getAll=="function"&&typeof e.getAllKeys=="function"&&r>1&&!n,o,v,g;function _(y){v=y.target.result,o&&i(o,v,g)}function b(y){o=y.target.result,v&&i(o,v,g)}function l(){if(!o.length)return i();var y=o[o.length-1],w;if(t&&t.upper)try{w=IDBKeyRange.bound(y,t.upper,!0,t.upperOpen)}catch(q){if(q.name==="DataError"&&q.code===0)return i()}else w=IDBKeyRange.lowerBound(y,!0);t=w,o=null,v=null,e.getAll(t,r).onsuccess=_,e.getAllKeys(t,r).onsuccess=b}function p(y){var w=y.target.result;if(!w)return i();i([w.key],[w.value],w)}a?(g={continue:l},e.getAll(t,r).onsuccess=_,e.getAllKeys(t,r).onsuccess=b):n?e.openCursor(t,"prev").onsuccess=p:e.openCursor(t).onsuccess=p}function ls(e,t,n){if(typeof e.getAll=="function"){e.getAll(t).onsuccess=n;return}var r=[];function i(a){var o=a.target.result;o?(r.push(o.value),o.continue()):n({target:{result:r}})}e.openCursor(t).onsuccess=i}function ds(e,t,n){var r=new Array(e.length),i=0;e.forEach(function(a,o){t.get(a).onsuccess=function(v){v.target.result?r[o]=v.target.result:r[o]={key:a,error:"not_found"},i++,i===e.length&&n(e,r,{})}})}function hs(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(a){return{error:a}}return null}function vs(e,t,n){var r="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,a="key"in e?e.key:!1,o="keys"in e?e.keys:!1,v=e.skip||0,g=typeof e.limit=="number"?e.limit:-1,_=e.inclusive_end!==!1,b,l;if(!o&&(b=hs(r,i,_,a,e.descending),l=b&&b.error,l&&!(l.name==="DataError"&&l.code===0)))return n(J(rn,l.name,l.message));var p=[ue,le,de];e.attachments&&p.push(_e);var y=me(t,p,"readonly");if(y.error)return n(y.error);var w=y.txn;w.oncomplete=K,w.onabort=Ae(n);var q=w.objectStore(ue),m=w.objectStore(le),h=w.objectStore(de),d=m.index("_doc_id_rev"),u=[],s,c;h.get(de).onsuccess=function(N){s=N.target.result.docCount},e.update_seq&&f(m,function(N){N.target.result&&N.target.result.length>0&&(c=N.target.result[0])});function f(N,G){function z(W){var S=W.target.result,A=void 0;return S&&S.key&&(A=S.key),G({target:{result:[A]}})}N.openCursor(null,"prev").onsuccess=z}function O(N,G,z){var W=N.id+"::"+z;d.get(W).onsuccess=function(A){if(G.doc=ht(A.target.result)||{},e.conflicts){var D=vn(N);D.length&&(G.doc._conflicts=D)}Pr(G.doc,e,w)}}function E(N,G){var z={id:G.id,key:G.id,value:{rev:N}},W=G.deleted;W?o&&(u.push(z),z.value.deleted=!0,z.doc=null):v--<=0&&(u.push(z),e.include_docs&&O(G,z,N))}function C(N){for(var G=0,z=N.length;G<z&&u.length!==g;G++){var W=N[G];if(W.error&&o){u.push(W);continue}var S=Re(W),A=S.winningRev;E(A,S)}}function P(N,G,z){z&&(C(G),u.length<g&&z.continue())}function j(N){var G=N.target.result;e.descending&&(G=G.reverse()),C(G)}function U(){var N={total_rows:s,offset:e.skip,rows:u};e.update_seq&&c!==void 0&&(N.update_seq=c),n(null,N)}function K(){e.attachments?Jt(u,e.binary).then(U):U()}if(!(l||g===0)){if(o)return ds(e.keys,q,P);if(g===-1)return ls(q,b,j);Br(q,b,e.descending,g+v,P)}}function gs(e){return new Promise(function(t){var n=on([""]),r=e.objectStore(Gt).put(n,"key");r.onsuccess=function(){var i=navigator.userAgent.match(/Chrome\/(\d+)/),a=navigator.userAgent.match(/Edge\//);t(a||!i||parseInt(i[1],10)>=43)},r.onerror=e.onabort=function(i){i.preventDefault(),i.stopPropagation(),t(!1)}}).catch(function(){return!1})}function _s(e,t){var n=e.objectStore(ue).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(r){t(r.target.result)}}var Qt=!1,Wt=[];function ps(e,t,n,r){try{e(t,n)}catch(i){r.emit("error",i)}}function Mn(){Qt||!Wt.length||(Qt=!0,Wt.shift()())}function ys(e,t,n){Wt.push(function(){e(function(a,o){ps(t,a,o,n),Qt=!1,qe(function(){Mn()})})}),Mn()}function ms(e,t,n,r){if(e=ce(e),e.continuous){var i=n+":"+yt();return Qe.addListener(n,i,t,e),Qe.notify(n),{cancel:function(){Qe.removeListener(n,i)}}}var a=e.doc_ids&&new Ke(e.doc_ids);e.since=e.since||0;var o=e.since,v="limit"in e?e.limit:-1;v===0&&(v=1);var g=[],_=0,b=an(e),l=new ve,p,y,w,q;function m(E,C,P){if(!P||!E.length)return;var j=new Array(E.length),U=new Array(E.length);function K(z,W){var S=e.processChange(W,z,e);o=S.seq=z.seq;var A=b(S);return typeof A=="object"?Promise.reject(A):A?(_++,e.return_docs&&g.push(S),e.attachments&&e.include_docs?new Promise(function(D){Pr(W,e,p,function(){Jt([S],e.binary).then(function(){D(S)})})}):Promise.resolve(S)):Promise.resolve()}function N(){for(var z=[],W=0,S=j.length;W<S&&_!==v;W++){var A=j[W];if(A){var D=U[W];z.push(K(D,A))}}Promise.all(z).then(function(k){for(var R=0,I=k.length;R<I;R++)k[R]&&e.onChange(k[R])}).catch(e.complete),_!==v&&P.continue()}var G=0;C.forEach(function(z,W){var S=ht(z),A=E[W];d(S,A,function(D,k){U[W]=D,j[W]=k,++G===E.length&&N()})})}function h(E,C,P,j){if(P.seq!==C)return j();if(P.winningRev===E._rev)return j(P,E);var U=E._id+"::"+P.winningRev,K=q.get(U);K.onsuccess=function(N){j(P,ht(N.target.result))}}function d(E,C,P){if(a&&!a.has(E._id))return P();var j=l.get(E._id);if(j)return h(E,C,j,P);w.get(E._id).onsuccess=function(U){j=Re(U.target.result),l.set(E._id,j),h(E,C,j,P)}}function u(){e.complete(null,{results:g,last_seq:o})}function s(){!e.continuous&&e.attachments?Jt(g).then(u):u()}var c=[ue,le];e.attachments&&c.push(_e);var f=me(r,c,"readonly");if(f.error)return e.complete(f.error);p=f.txn,p.onabort=Ae(e.complete),p.oncomplete=s,y=p.objectStore(le),w=p.objectStore(ue),q=y.index("_doc_id_rev");var O=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null;Br(y,O,e.descending,v,m)}var Ne=new ve,Ct,xt=new ve;function Lr(e,t){var n=this;ys(function(r){ws(n,e,r)},t,n.constructor)}function ws(e,t,n){var r=t.name,i=null,a=null;e._meta=null;function o(m){return function(h,d){h&&h instanceof Error&&!h.reason&&a&&(h.reason=a),m(h,d)}}function v(m){var h=m.createObjectStore(ue,{keyPath:"id"});m.createObjectStore(le,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),m.createObjectStore(_e,{keyPath:"digest"}),m.createObjectStore(de,{keyPath:"id",autoIncrement:!1}),m.createObjectStore(Gt),h.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),m.createObjectStore(be,{keyPath:"_id"});var d=m.createObjectStore(Pe,{autoIncrement:!0});d.createIndex("seq","seq"),d.createIndex("digestSeq","digestSeq",{unique:!0})}function g(m,h){var d=m.objectStore(ue);d.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),d.openCursor().onsuccess=function(u){var s=u.target.result;if(s){var c=s.value,f=Ee(c);c.deletedOrLocal=f?"1":"0",d.put(c),s.continue()}else h()}}function _(m){m.createObjectStore(be,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function b(m,h){var d=m.objectStore(be),u=m.objectStore(ue),s=m.objectStore(le),c=u.openCursor();c.onsuccess=function(f){var O=f.target.result;if(O){var E=O.value,C=E.id,P=Be(C),j=je(E);if(P){var U=C+"::"+j,K=C+"::",N=C+"::~",G=s.index("_doc_id_rev"),z=IDBKeyRange.bound(K,N,!1,!1),W=G.openCursor(z);W.onsuccess=function(S){if(W=S.target.result,!W)u.delete(O.primaryKey),O.continue();else{var A=W.value;A._doc_id_rev===U&&d.put(A),s.delete(W.primaryKey),W.continue()}}}else O.continue()}else h&&h()}}function l(m){var h=m.createObjectStore(Pe,{autoIncrement:!0});h.createIndex("seq","seq"),h.createIndex("digestSeq","digestSeq",{unique:!0})}function p(m,h){var d=m.objectStore(le),u=m.objectStore(_e),s=m.objectStore(Pe),c=u.count();c.onsuccess=function(f){var O=f.target.result;if(!O)return h();d.openCursor().onsuccess=function(E){var C=E.target.result;if(!C)return h();for(var P=C.value,j=C.primaryKey,U=Object.keys(P._attachments||{}),K={},N=0;N<U.length;N++){var G=P._attachments[U[N]];K[G.digest]=!0}var z=Object.keys(K);for(N=0;N<z.length;N++){var W=z[N];s.put({seq:j,digestSeq:W+"::"+j})}C.continue()}}}function y(m){function h(c){return c.data?Re(c):(c.deleted=c.deletedOrLocal==="1",c)}var d=m.objectStore(le),u=m.objectStore(ue),s=u.openCursor();s.onsuccess=function(c){var f=c.target.result;if(!f)return;var O=h(f.value);O.winningRev=O.winningRev||je(O);function E(){var P=O.id+"::",j=O.id+"::",U=d.index("_doc_id_rev").openCursor(IDBKeyRange.bound(P,j)),K=0;U.onsuccess=function(N){var G=N.target.result;if(!G)return O.seq=K,C();var z=G.primaryKey;z>K&&(K=z),G.continue()}}function C(){var P=zt(O,O.winningRev,O.deleted),j=u.put(P);j.onsuccess=function(){f.continue()}}if(O.seq)return C();E()}}e._remote=!1,e.type=function(){return"idb"},e._id=sr(function(m){m(null,e._meta.instanceId)}),e._bulkDocs=function(h,d,u){fs(t,h,d,e,i,o(u))},e._get=function(h,d,u){var s,c,f,O=d.ctx;if(!O){var E=me(i,[ue,le,_e],"readonly");if(E.error)return u(E.error);O=E.txn}function C(){u(f,{doc:s,metadata:c,ctx:O})}O.objectStore(ue).get(h).onsuccess=function(P){if(c=Re(P.target.result),!c)return f=J(ge,"missing"),C();var j;if(d.rev)j=d.latest?Yi(d.rev,c):d.rev;else{j=c.winningRev;var U=Ee(c);if(U)return f=J(ge,"deleted"),C()}var K=O.objectStore(le),N=c.id+"::"+j;K.index("_doc_id_rev").get(N).onsuccess=function(G){if(s=G.target.result,s&&(s=ht(s)),!s)return f=J(ge,"missing"),C();C()}}},e._getAttachment=function(m,h,d,u,s){var c;if(u.ctx)c=u.ctx;else{var f=me(i,[ue,le,_e],"readonly");if(f.error)return s(f.error);c=f.txn}var O=d.digest,E=d.content_type;c.objectStore(_e).get(O).onsuccess=function(C){var P=C.target.result.body;Dr(P,E,u.binary,function(j){s(null,j)})}},e._info=function(h){var d,u,s=me(i,[de,le],"readonly");if(s.error)return h(s.error);var c=s.txn;c.objectStore(de).get(de).onsuccess=function(f){u=f.target.result.docCount},c.objectStore(le).openCursor(null,"prev").onsuccess=function(f){var O=f.target.result;d=O?O.key:0},c.oncomplete=function(){h(null,{doc_count:u,update_seq:d,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(h,d){vs(h,i,o(d))},e._changes=function(h){return ms(h,e,r,i)},e._close=function(m){i.close(),Ne.delete(r),m()},e._getRevisionTree=function(m,h){var d=me(i,[ue],"readonly");if(d.error)return h(d.error);var u=d.txn,s=u.objectStore(ue).get(m);s.onsuccess=function(c){var f=Re(c.target.result);f?h(null,f.rev_tree):h(J(ge))}},e._doCompaction=function(m,h,d){var u=[ue,le,_e,Pe],s=me(i,u,"readwrite");if(s.error)return d(s.error);var c=s.txn,f=c.objectStore(ue);f.get(m).onsuccess=function(O){var E=Re(O.target.result);Ie(E.rev_tree,function(j,U,K,N,G){var z=U+"-"+K;h.indexOf(z)!==-1&&(G.status="missing")}),Rr(h,m,c);var C=E.winningRev,P=E.deleted;c.objectStore(ue).put(zt(E,C,P))},c.onabort=Ae(d),c.oncomplete=function(){d()}},e._getLocal=function(m,h){var d=me(i,[be],"readonly");if(d.error)return h(d.error);var u=d.txn,s=u.objectStore(be).get(m);s.onerror=Ae(h),s.onsuccess=function(c){var f=c.target.result;f?(delete f._doc_id_rev,h(null,f)):h(J(ge))}},e._putLocal=function(m,h,d){typeof h=="function"&&(d=h,h={}),delete m._revisions;var u=m._rev,s=m._id;u?m._rev="0-"+(parseInt(u.split("-")[1],10)+1):m._rev="0-1";var c=h.ctx,f;if(!c){var O=me(i,[be],"readwrite");if(O.error)return d(O.error);c=O.txn,c.onerror=Ae(d),c.oncomplete=function(){f&&d(null,f)}}var E=c.objectStore(be),C;u?(C=E.get(s),C.onsuccess=function(P){var j=P.target.result;if(!j||j._rev!==u)d(J(Fe));else{var U=E.put(m);U.onsuccess=function(){f={ok:!0,id:m._id,rev:m._rev},h.ctx&&d(null,f)}}}):(C=E.add(m),C.onerror=function(P){d(J(Fe)),P.preventDefault(),P.stopPropagation()},C.onsuccess=function(){f={ok:!0,id:m._id,rev:m._rev},h.ctx&&d(null,f)})},e._removeLocal=function(m,h,d){typeof h=="function"&&(d=h,h={});var u=h.ctx;if(!u){var s=me(i,[be],"readwrite");if(s.error)return d(s.error);u=s.txn,u.oncomplete=function(){c&&d(null,c)}}var c,f=m._id,O=u.objectStore(be),E=O.get(f);E.onerror=Ae(d),E.onsuccess=function(C){var P=C.target.result;!P||P._rev!==m._rev?d(J(ge)):(O.delete(f),c={ok:!0,id:f,rev:"0-0"},h.ctx&&d(null,c))}},e._destroy=function(m,h){Qe.removeAllListeners(r);var d=xt.get(r);d&&d.result&&(d.result.close(),Ne.delete(r));var u=indexedDB.deleteDatabase(r);u.onsuccess=function(){xt.delete(r),ct()&&r in localStorage&&delete localStorage[r],h(null,{ok:!0})},u.onerror=Ae(h)};var w=Ne.get(r);if(w)return i=w.idb,e._meta=w.global,qe(function(){n(null,e)});var q=indexedDB.open(r,us);xt.set(r,q),q.onupgradeneeded=function(m){var h=m.target.result;if(m.oldVersion<1)return v(h);var d=m.currentTarget.transaction;m.oldVersion<3&&_(h),m.oldVersion<4&&l(h);var u=[g,b,p,y],s=m.oldVersion;function c(){var f=u[s-1];s++,f&&f(d,c)}c()},q.onsuccess=function(m){i=m.target.result,i.onversionchange=function(){i.close(),Ne.delete(r)},i.onabort=function(C){pe("error","Database has a global failure",C.target.error),a=C.target.error,i.close(),Ne.delete(r)};var h=i.transaction([de,Gt,ue],"readwrite"),d=!1,u,s,c,f;function O(){typeof c>"u"||!d||(e._meta={name:r,instanceId:f,blobSupport:c},Ne.set(r,{idb:i,global:e._meta}),n(null,e))}function E(){if(!(typeof s>"u"||typeof u>"u")){var C=r+"_id";C in u?f=u[C]:u[C]=f=yt(),u.docCount=s,h.objectStore(de).put(u)}}h.objectStore(de).get(de).onsuccess=function(C){u=C.target.result||{id:de},E()},_s(h,function(C){s=C,E()}),Ct||(Ct=gs(h)),Ct.then(function(C){c=C,O()}),h.oncomplete=function(){d=!0,O()},h.onabort=Ae(n)},q.onerror=function(m){var h=m.target.error&&m.target.error.message;h?h.indexOf("stored database is a higher version")!==-1&&(h=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):h="Failed to open indexedDB, are you in private browsing mode?",pe("error",h),n(J(rn,h))}}Lr.valid=function(){try{return typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}};function bs(e){e.adapter("idb",Lr,!0)}function Ss(e,t){return new Promise(function(n,r){var i=0,a=0,o=0,v=e.length,g;function _(){i++,e[a++]().then(l,p)}function b(){++o===v?g?r(g):n():y()}function l(){i--,b()}function p(w){i--,g=g||w,b()}function y(){for(;i<t&&a<v;)_()}y()})}const As=25,Os=50,st=5e3,qs=1e4;let kt={};function Tt(e){let t=e.doc||e.ok,n=t&&t._attachments;n&&Object.keys(n).forEach(function(r){let i=n[r];i.data=fn(i.data,i.content_type)})}function Te(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function Un(e){return!e._attachments||!Object.keys(e._attachments)?Promise.resolve():Promise.all(Object.keys(e._attachments).map(function(t){let n=e._attachments[t];if(n.data&&typeof n.data!="string")return new Promise(function(r){ln(n.data,r)}).then(function(r){n.data=r})}))}function Es(e){if(!e.prefix)return!1;let t=dr(e.prefix).protocol;return t==="http"||t==="https"}function Cs(e,t){if(Es(t)){let i=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}let n=dr(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});let r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),n.db.indexOf("%")===-1&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}function oe(e,t){return ot(e,e.db+"/"+t)}function ot(e,t){let n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function ut(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function xs(e){let t=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=t.indexOf("msie")!==-1,r=t.indexOf("trident")!==-1,i=t.indexOf("edge")!==-1,a=!("method"in e)||e.method==="GET";return(n||r||i)&&a}function Ht(e,t){let n=this,r=Cs(e.name,e),i=oe(r,"");e=ce(e);const a=async function(l,p){if(p=p||{},p.headers=p.headers||new Me,p.credentials="include",e.auth||r.auth){let q=e.auth||r.auth,m=q.username+":"+q.password,h=Ye(unescape(encodeURIComponent(m)));p.headers.set("Authorization","Basic "+h)}let y=e.headers||{};return Object.keys(y).forEach(function(q){p.headers.append(q,y[q])}),xs(p)&&(l+=(l.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now()),await(e.fetch||Ar)(l,p)};function o(l,p){return re(l,function(...y){_().then(function(){return p.apply(this,y)}).catch(function(w){y.pop()(w)})}).bind(n)}async function v(l,p){let y={};p=p||{},p.headers=p.headers||new Me,p.headers.get("Content-Type")||p.headers.set("Content-Type","application/json"),p.headers.get("Accept")||p.headers.set("Accept","application/json");const w=await a(l,p);y.ok=w.ok,y.status=w.status;const q=await w.json();if(y.data=q,!y.ok)throw y.data.status=y.status,Ge(y.data);return Array.isArray(y.data)&&(y.data=y.data.map(function(m){return m.error||m.missing?Ge(m):m})),y}let g;async function _(){return e.skip_setup?Promise.resolve():g||(g=v(i).catch(function(l){return l&&l.status&&l.status===404?(It(404,"PouchDB is just detecting if the remote exists."),v(i,{method:"PUT"})):Promise.reject(l)}).catch(function(l){return l&&l.status&&l.status===412?!0:Promise.reject(l)}),g.catch(function(){g=null}),g)}qe(function(){t(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=o("id",async function(l){let p;try{p=await(await a(ot(r,""))).json()}catch{p={}}let y=p&&p.uuid?p.uuid+r.db:oe(r,"");l(null,y)}),n.compact=o("compact",async function(l,p){typeof l=="function"&&(p=l,l={}),l=ce(l),await v(oe(r,"_compact"),{method:"POST"});function y(){n.info(function(w,q){q&&!q.compact_running?p(null,{ok:!0}):setTimeout(y,l.interval||200)})}y()}),n.bulkGet=re("bulkGet",function(l,p){let y=this;async function w(d){let u={};l.revs&&(u.revs=!0),l.attachments&&(u.attachments=!0),l.latest&&(u.latest=!0);try{const s=await v(oe(r,"_bulk_get"+ut(u)),{method:"POST",body:JSON.stringify({docs:l.docs})});l.attachments&&l.binary&&s.data.results.forEach(function(c){c.docs.forEach(Tt)}),d(null,s.data)}catch(s){d(s)}}function q(){let d=Os,u=Math.ceil(l.docs.length/d),s=0,c=new Array(u);function f(O){return function(E,C){c[O]=C.results,++s===u&&p(null,{results:ft(c)})}}for(let O=0;O<u;O++){let E=Xe(l,["revs","attachments","binary","latest"]);E.docs=l.docs.slice(O*d,Math.min(l.docs.length,(O+1)*d)),ur(y,E,f(O))}}let m=ot(r,""),h=kt[m];typeof h!="boolean"?w(function(d,u){d?(kt[m]=!1,It(d.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),q()):(kt[m]=!0,p(null,u))}):h?w(p):q()}),n._info=async function(l){try{await _();const y=await(await a(oe(r,""))).json();y.host=oe(r,""),l(null,y)}catch(p){l(p)}},n.fetch=async function(l,p){await _();const y=l.substring(0,1)==="/"?ot(r,l.substring(1)):oe(r,l);return a(y,p)},n.get=o("get",async function(l,p,y){typeof p=="function"&&(y=p,p={}),p=ce(p);let w={};p.revs&&(w.revs=!0),p.revs_info&&(w.revs_info=!0),p.latest&&(w.latest=!0),p.open_revs&&(p.open_revs!=="all"&&(p.open_revs=JSON.stringify(p.open_revs)),w.open_revs=p.open_revs),p.rev&&(w.rev=p.rev),p.conflicts&&(w.conflicts=p.conflicts),p.update_seq&&(w.update_seq=p.update_seq),l=Te(l);function q(d){let u=d._attachments,s=u&&Object.keys(u);if(!u||!s.length)return;async function c(O){const E=u[O],C=Te(d._id)+"/"+b(O)+"?rev="+d._rev,P=await a(oe(r,C));let j;"buffer"in P?j=await P.buffer():j=await P.blob();let U;if(p.binary){let K=Object.getOwnPropertyDescriptor(j.__proto__,"type");(!K||K.set)&&(j.type=E.content_type),U=j}else U=await new Promise(function(K){ln(j,K)});delete E.stub,delete E.length,E.data=U}let f=s.map(function(O){return function(){return c(O)}});return Ss(f,5)}function m(d){return Array.isArray(d)?Promise.all(d.map(function(u){if(u.ok)return q(u.ok)})):q(d)}const h=oe(r,l+ut(w));try{const d=await v(h);p.attachments&&await m(d.data),y(null,d.data)}catch(d){d.docId=l,y(d)}}),n.remove=o("remove",async function(l,p,y,w){let q;typeof p=="string"?(q={_id:l,_rev:p},typeof y=="function"&&(w=y,y={})):(q=l,typeof p=="function"?(w=p,y={}):(w=y,y=p));const m=q._rev||y.rev,h=oe(r,Te(q._id))+"?rev="+m;try{const d=await v(h,{method:"DELETE"});w(null,d.data)}catch(d){w(d)}});function b(l){return l.split("/").map(encodeURIComponent).join("/")}n.getAttachment=o("getAttachment",async function(l,p,y,w){typeof y=="function"&&(w=y,y={});const q=y.rev?"?rev="+y.rev:"",m=oe(r,Te(l))+"/"+b(p)+q;let h;try{const u=await a(m,{method:"GET"});if(!u.ok)throw u;h=u.headers.get("content-type");let s;if(typeof process<"u"&&!process.browser&&typeof u.buffer=="function"?s=await u.buffer():s=await u.blob(),typeof process<"u"&&!process.browser){var d=Object.getOwnPropertyDescriptor(s.__proto__,"type");(!d||d.set)&&(s.type=h)}w(null,s)}catch(u){w(u)}}),n.removeAttachment=o("removeAttachment",async function(l,p,y,w){const q=oe(r,Te(l)+"/"+b(p))+"?rev="+y;try{const m=await v(q,{method:"DELETE"});w(null,m.data)}catch(m){w(m)}}),n.putAttachment=o("putAttachment",async function(l,p,y,w,q,m){typeof q=="function"&&(m=q,q=w,w=y,y=null);const h=Te(l)+"/"+b(p);let d=oe(r,h);if(y&&(d+="?rev="+y),typeof w=="string"){let u;try{u=un(w)}catch{return m(J(cr,"Attachment is not a valid base64 string"))}w=u?cn(u,q):""}try{const u=await v(d,{headers:new Me({"Content-Type":q}),method:"PUT",body:w});m(null,u.data)}catch(u){m(u)}}),n._bulkDocs=async function(l,p,y){l.new_edits=p.new_edits;try{await _(),await Promise.all(l.docs.map(Un));const w=await v(oe(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(l)});y(null,w.data)}catch(w){y(w)}},n._put=async function(l,p,y){try{await _(),await Un(l);const w=await v(oe(r,Te(l._id)),{method:"PUT",body:JSON.stringify(l)});y(null,w.data)}catch(w){w.docId=l&&l._id,y(w)}},n.allDocs=o("allDocs",async function(l,p){typeof l=="function"&&(p=l,l={}),l=ce(l);let y={},w,q="GET";l.conflicts&&(y.conflicts=!0),l.update_seq&&(y.update_seq=!0),l.descending&&(y.descending=!0),l.include_docs&&(y.include_docs=!0),l.attachments&&(y.attachments=!0),l.key&&(y.key=JSON.stringify(l.key)),l.start_key&&(l.startkey=l.start_key),l.startkey&&(y.startkey=JSON.stringify(l.startkey)),l.end_key&&(l.endkey=l.end_key),l.endkey&&(y.endkey=JSON.stringify(l.endkey)),typeof l.inclusive_end<"u"&&(y.inclusive_end=!!l.inclusive_end),typeof l.limit<"u"&&(y.limit=l.limit),typeof l.skip<"u"&&(y.skip=l.skip);let m=ut(y);typeof l.keys<"u"&&(q="POST",w={keys:l.keys});try{const h=await v(oe(r,"_all_docs"+m),{method:q,body:JSON.stringify(w)});l.include_docs&&l.attachments&&l.binary&&h.data.rows.forEach(Tt),p(null,h.data)}catch(h){p(h)}}),n._changes=function(l){let p="batch_size"in l?l.batch_size:As;l=ce(l),l.continuous&&!("heartbeat"in l)&&(l.heartbeat=qs);let y="timeout"in l?l.timeout:30*1e3;"timeout"in l&&l.timeout&&y-l.timeout<st&&(y=l.timeout+st),"heartbeat"in l&&l.heartbeat&&y-l.heartbeat<st&&(y=l.heartbeat+st);let w={};"timeout"in l&&l.timeout&&(w.timeout=l.timeout);let q=typeof l.limit<"u"?l.limit:!1,m=q;if(l.style&&(w.style=l.style),(l.include_docs||l.filter&&typeof l.filter=="function")&&(w.include_docs=!0),l.attachments&&(w.attachments=!0),l.continuous&&(w.feed="longpoll"),l.seq_interval&&(w.seq_interval=l.seq_interval),l.conflicts&&(w.conflicts=!0),l.descending&&(w.descending=!0),l.update_seq&&(w.update_seq=!0),"heartbeat"in l&&l.heartbeat&&(w.heartbeat=l.heartbeat),l.filter&&typeof l.filter=="string"&&(w.filter=l.filter),l.view&&typeof l.view=="string"&&(w.filter="_view",w.view=l.view),l.query_params&&typeof l.query_params=="object")for(let E in l.query_params)Object.prototype.hasOwnProperty.call(l.query_params,E)&&(w[E]=l.query_params[E]);let h="GET",d;l.doc_ids?(w.filter="_doc_ids",h="POST",d={doc_ids:l.doc_ids}):l.selector&&(w.filter="_selector",h="POST",d={selector:l.selector});let u=new la,s;const c=async function(E,C){if(l.aborted)return;w.since=E,typeof w.since=="object"&&(w.since=JSON.stringify(w.since)),l.descending?q&&(w.limit=m):w.limit=!q||m>p?p:m;let P=oe(r,"_changes"+ut(w)),j={signal:u.signal,method:h,body:JSON.stringify(d)};if(s=E,!l.aborted)try{await _();const U=await v(P,j);C(null,U.data)}catch(U){C(U)}};let f={results:[]};const O=function(E,C){if(l.aborted)return;let P=0;if(C&&C.results){P=C.results.length,f.last_seq=C.last_seq;let U=null,K=null;typeof C.pending=="number"&&(U=C.pending),(typeof f.last_seq=="string"||typeof f.last_seq=="number")&&(K=f.last_seq),l.query_params,C.results=C.results.filter(function(N){m--;let G=an(l)(N);return G&&(l.include_docs&&l.attachments&&l.binary&&Tt(N),l.return_docs&&f.results.push(N),l.onChange(N,U,K)),G})}else if(E){l.aborted=!0,l.complete(E);return}C&&C.last_seq&&(s=C.last_seq);let j=q&&m<=0||C&&P<p||l.descending;l.continuous&&!(q&&m<=0)||!j?qe(function(){c(s,O)}):l.complete(null,f)};return c(l.since||0,O),{cancel:function(){l.aborted=!0,u.abort()}}},n.revsDiff=o("revsDiff",async function(l,p,y){typeof p=="function"&&(y=p,p={});try{const w=await v(oe(r,"_revs_diff"),{method:"POST",body:JSON.stringify(l)});y(null,w.data)}catch(w){y(w)}}),n._close=function(l){l()},n._destroy=async function(l,p){try{const y=await v(oe(r,""),{method:"DELETE"});p(null,y)}catch(y){y.status===404?p(null,{ok:!0}):p(y)}}}Ht.valid=function(){return!0};function ks(e){e.adapter("http",Ht,!1),e.adapter("https",Ht,!1)}class De extends Error{constructor(t){super(),this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,De)}catch{}}}class mt extends Error{constructor(t){super(),this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,mt)}catch{}}}class wt extends Error{constructor(t){super(),this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,wt)}catch{}}}function jr(e,t){return t&&e.then(function(n){qe(function(){t(null,n)})},function(n){qe(function(){t(n)})}),e}function Ts(e){return function(...t){var n=t.pop(),r=e.apply(this,t);return typeof n=="function"&&jr(r,n),r}}function Ds(e,t){return e.then(function(n){return t().then(function(){return n})},function(n){return t().then(function(){throw n})})}function Dt(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function Kn(e){var t=new Ke(e),n=new Array(t.size),r=-1;return t.forEach(function(i){n[++r]=i}),n}function Pt(e){var t=new Array(e.size),n=-1;return e.forEach(function(r,i){t[++n]=i}),t}function Fn(e){var t="builtin "+e+" function requires map values to be numbers or number arrays";return new wt(t)}function Xt(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if(typeof i!="number")if(Array.isArray(i)){t=typeof t=="number"?[t]:t;for(var a=0,o=i.length;a<o;a++){var v=i[a];if(typeof v!="number")throw Fn("_sum");typeof t[a]>"u"?t.push(v):t[a]+=v}}else throw Fn("_sum");else typeof t=="number"?t+=i:t[0]+=i}return t}var Ps=pe.bind(null,"log"),Rs=Array.isArray,Bs=JSON.parse;function Ir(e,t){return sn("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Xt,log:Ps,isArray:Rs,toJSON:Bs})}class Yt{constructor(){this.promise=new Promise(function(t){t()})}add(t){return this.promise=this.promise.catch(function(){}).then(function(){return t()}),this.promise}finish(){return this.promise}}function Gn(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function Ls(e,t){return Gn(e)+Gn(t)+"undefined"}async function zn(e,t,n,r,i,a){const o=Ls(n,r);let v;if(!i&&(v=e._cachedViews=e._cachedViews||{},v[o]))return v[o];const g=e.info().then(async function(_){const b=_.db_name+"-mrview-"+(i?"temp":gr(o));function l(m){m.views=m.views||{};let h=t;h.indexOf("/")===-1&&(h=t+"/"+t);const d=m.views[h]=m.views[h]||{};if(!d[b])return d[b]=!0,m}await lt(e,"_local/"+a,l);const y=(await e.registerDependentDatabase(b)).db;y.auto_compaction=!0;const w={name:b,db:y,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};let q;try{q=await w.db.get("_local/lastSeq")}catch(m){if(m.status!==404)throw m}return w.seq=q?q.seq:0,v&&w.db.once("destroyed",function(){delete v[o]}),w});return v&&(v[o]=g),g}var Jn={},Qn=new Yt,js=50;function Rt(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function Is(e){return e.length===1&&/^1-/.test(e[0].rev)}function Wn(e,t,n){try{e.emit("error",t)}catch{pe("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),pe("error",t,n)}}function $s(e,t,n,r){function i(S,A,D){try{A(D)}catch(k){Wn(S,k,{fun:A,doc:D})}}function a(S,A,D,k,R){try{return{output:A(D,k,R)}}catch(I){return Wn(S,I,{fun:A,keys:D,values:k,rereduce:R}),{error:I}}}function o(S,A){const D=ie(S.key,A.key);return D!==0?D:ie(S.value,A.value)}function v(S,A,D){return D=D||0,typeof A=="number"?S.slice(D,A+D):D>0?S.slice(D):S}function g(S){const A=S.value;return A&&typeof A=="object"&&A._id||S.id}function _(S){S.rows.forEach(function(A){const D=A.doc&&A.doc._attachments;D&&Object.keys(D).forEach(function(k){const R=D[k];D[k].data=fn(R.data,R.content_type)})})}function b(S){return function(A){return S.include_docs&&S.attachments&&S.binary&&_(A),A}}function l(S,A,D,k){let R=A[S];typeof R<"u"&&(k&&(R=encodeURIComponent(JSON.stringify(R))),D.push(S+"="+R))}function p(S){if(typeof S<"u"){const A=Number(S);return!isNaN(A)&&A===parseInt(S,10)?A:S}}function y(S){return S.group_level=p(S.group_level),S.limit=p(S.limit),S.skip=p(S.skip),S}function w(S){if(S){if(typeof S!="number")return new De(`Invalid value for integer: "${S}"`);if(S<0)return new De(`Invalid value for positive integer: "${S}"`)}}function q(S,A){const D=S.descending?"endkey":"startkey",k=S.descending?"startkey":"endkey";if(typeof S[D]<"u"&&typeof S[k]<"u"&&ie(S[D],S[k])>0)throw new De("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(A.reduce&&S.reduce!==!1){if(S.include_docs)throw new De("{include_docs:true} is invalid for reduce");if(S.keys&&S.keys.length>1&&!S.group&&!S.group_level)throw new De("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(R){const I=w(S[R]);if(I)throw I})}async function m(S,A,D){let k=[],R,I="GET",F;if(l("reduce",D,k),l("include_docs",D,k),l("attachments",D,k),l("limit",D,k),l("descending",D,k),l("group",D,k),l("group_level",D,k),l("skip",D,k),l("stale",D,k),l("conflicts",D,k),l("startkey",D,k,!0),l("start_key",D,k,!0),l("endkey",D,k,!0),l("end_key",D,k,!0),l("inclusive_end",D,k),l("key",D,k,!0),l("update_seq",D,k),k=k.join("&"),k=k===""?"":"?"+k,typeof D.keys<"u"){const B=`keys=${encodeURIComponent(JSON.stringify(D.keys))}`;B.length+k.length+1<=2e3?k+=(k[0]==="?"?"&":"?")+B:(I="POST",typeof A=="string"?R={keys:D.keys}:A.keys=D.keys)}if(typeof A=="string"){const T=Rt(A),B=await S.fetch("_design/"+T[0]+"/_view/"+T[1]+k,{headers:new Me({"Content-Type":"application/json"}),method:I,body:JSON.stringify(R)});F=B.ok;const $=await B.json();if(!F)throw $.status=B.status,Ge($);return $.rows.forEach(function(M){if(M.value&&M.value.error&&M.value.error==="builtin_reduce_error")throw new Error(M.reason)}),new Promise(function(M){M($)}).then(b(D))}R=R||{},Object.keys(A).forEach(function(T){Array.isArray(A[T])?R[T]=A[T]:R[T]=A[T].toString()});const L=await S.fetch("_temp_view"+k,{headers:new Me({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(R)});F=L.ok;const x=await L.json();if(!F)throw x.status=L.status,Ge(x);return new Promise(function(T){T(x)}).then(b(D))}function h(S,A,D){return new Promise(function(k,R){S._query(A,D,function(I,F){if(I)return R(I);k(F)})})}function d(S){return new Promise(function(A,D){S._viewCleanup(function(k,R){if(k)return D(k);A(R)})})}function u(S){return function(A){if(A.status===404)return S;throw A}}async function s(S,A,D){const k="_local/doc_"+S,R={_id:k,keys:[]},I=D.get(S),F=I[0],L=I[1];function x(){return Is(L)?Promise.resolve(R):A.db.get(k).catch(u(R))}function T(X){return X.keys.length?A.db.allDocs({keys:X.keys,include_docs:!0}):Promise.resolve({rows:[]})}function B(X,V){const ae=[],he=new Ke;for(let H=0,Y=V.rows.length;H<Y;H++){const se=V.rows[H].doc;if(se&&(ae.push(se),he.add(se._id),se._deleted=!F.has(se._id),!se._deleted)){const ne=F.get(se._id);"value"in ne&&(se.value=ne.value)}}const we=Pt(F);return we.forEach(function(H){if(!he.has(H)){const Y={_id:H},ee=F.get(H);"value"in ee&&(Y.value=ee.value),ae.push(Y)}}),X.keys=Kn(we.concat(X.keys)),ae.push(X),ae}const $=await x(),M=await T($);return B($,M)}function c(S){return S.sourceDB.get("_local/purges").then(function(A){const D=A.purgeSeq;return S.db.get("_local/purgeSeq").then(function(k){return k._rev}).catch(function(k){if(k.status!==404)throw k}).then(function(k){return S.db.put({_id:"_local/purgeSeq",_rev:k,purgeSeq:D})})}).catch(function(A){if(A.status!==404)throw A})}function f(S,A,D){var k="_local/lastSeq";return S.db.get(k).catch(u({_id:k,seq:0})).then(function(R){var I=Pt(A);return Promise.all(I.map(function(F){return s(F,S,A)})).then(function(F){var L=ft(F);return R.seq=D,L.push(R),S.db.bulkDocs({docs:L})}).then(()=>c(S))})}function O(S){const A=typeof S=="string"?S:S.name;let D=Jn[A];return D||(D=Jn[A]=new Yt),D}async function E(S,A){return Dt(O(S),function(){return C(S,A)})()}async function C(S,A){let D,k,R;function I(H,Y){const ee={id:k._id,key:$e(H)};typeof Y<"u"&&Y!==null&&(ee.value=$e(Y)),D.push(ee)}const F=t(S.mapFun,I);let L=S.seq||0;function x(){return S.sourceDB.info().then(function(H){R=S.sourceDB.activeTasks.add({name:"view_indexing",total_items:H.update_seq-L})})}function T(H,Y){return function(){return f(S,H,Y)}}let B=0;const $={view:S.name,indexed_docs:B};S.sourceDB.emit("indexing",$);const M=new Yt;async function X(){const H=await S.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:L,limit:A.changes_batch_size}),Y=await V();return ae(H,Y)}function V(){return S.db.get("_local/purgeSeq").then(function(H){return H.purgeSeq}).catch(function(H){if(H&&H.status!==404)throw H;return-1}).then(function(H){return S.sourceDB.get("_local/purges").then(function(Y){const ee=Y.purges.filter(function(ne,te){return te>H}).map(ne=>ne.docId),se=ee.filter(function(ne,te){return ee.indexOf(ne)===te});return Promise.all(se.map(function(ne){return S.sourceDB.get(ne).then(function(te){return{docId:ne,doc:te}}).catch(function(te){if(te.status!==404)throw te;return{docId:ne}})}))}).catch(function(Y){if(Y&&Y.status!==404)throw Y;return[]})})}function ae(H,Y){var ee=H.results;if(!ee.length&&!Y.length)return;for(let te of Y)if(ee.findIndex(function(ze){return ze.id===te.docId})<0){const ze={_id:te.docId,doc:{_id:te.docId,_deleted:1},changes:[]};te.doc&&(ze.doc=te.doc,ze.changes.push({rev:te.doc._rev})),ee.push(ze)}var se=he(ee);M.add(T(se,L)),B=B+ee.length;const ne={view:S.name,last_seq:H.last_seq,results_count:ee.length,indexed_docs:B};if(S.sourceDB.emit("indexing",ne),S.sourceDB.activeTasks.update(R,{completed_items:B}),!(ee.length<A.changes_batch_size))return X()}function he(H){const Y=new ve;for(let ee=0,se=H.length;ee<se;ee++){const ne=H[ee];if(ne.doc._id[0]!=="_"){D=[],k=ne.doc,k._deleted||i(S.sourceDB,F,k),D.sort(o);const te=we(D);Y.set(ne.doc._id,[te,ne.changes])}L=ne.seq}return Y}function we(H){const Y=new ve;let ee;for(let se=0,ne=H.length;se<ne;se++){const te=H[se],bt=[te.key,te.id];se>0&&ie(te.key,ee)===0&&bt.push(se),Y.set(ye(bt),te),ee=te.key}return Y}try{await x(),await X(),await M.finish(),S.seq=L,S.sourceDB.activeTasks.remove(R)}catch(H){S.sourceDB.activeTasks.remove(R,H)}}function P(S,A,D){D.group_level===0&&delete D.group_level;const k=D.group||D.group_level,R=n(S.reduceFun),I=[],F=isNaN(D.group_level)?Number.POSITIVE_INFINITY:D.group_level;A.forEach(function(L){const x=I[I.length-1];let T=k?L.key:null;if(k&&Array.isArray(T)&&(T=T.slice(0,F)),x&&ie(x.groupKey,T)===0){x.keys.push([L.key,L.id]),x.values.push(L.value);return}I.push({keys:[[L.key,L.id]],values:[L.value],groupKey:T})}),A=[];for(let L=0,x=I.length;L<x;L++){const T=I[L],B=a(S.sourceDB,R,T.keys,T.values,!1);if(B.error&&B.error instanceof wt)throw B.error;A.push({value:B.error?null:B.output,key:T.groupKey})}return{rows:v(A,D.limit,D.skip)}}function j(S,A){return Dt(O(S),function(){return U(S,A)})()}async function U(S,A){let D;const k=S.reduceFun&&A.reduce!==!1,R=A.skip||0;typeof A.keys<"u"&&!A.keys.length&&(A.limit=0,delete A.keys);async function I(L){L.include_docs=!0;const x=await S.db.allDocs(L);return D=x.total_rows,x.rows.map(function(T){if("value"in T.doc&&typeof T.doc.value=="object"&&T.doc.value!==null){const $=Object.keys(T.doc.value).sort(),M=["id","key","value"];if(!($<M||$>M))return T.doc.value}const B=ka(T.doc._id);return{key:B[0],id:B[1],value:"value"in T.doc?T.doc.value:null}})}async function F(L){let x;if(k?x=P(S,L,A):typeof A.keys>"u"?x={total_rows:D,offset:R,rows:L}:x={total_rows:D,offset:R,rows:v(L,A.limit,A.skip)},A.update_seq&&(x.update_seq=S.seq),A.include_docs){const B=Kn(L.map(g)),$=await S.sourceDB.allDocs({keys:B,include_docs:!0,conflicts:A.conflicts,attachments:A.attachments,binary:A.binary});var T=new ve;return $.rows.forEach(function(M){T.set(M.id,M.doc)}),L.forEach(function(M){var X=g(M),V=T.get(X);V&&(M.doc=V)}),x}else return x}if(typeof A.keys<"u"){const x=A.keys.map(function($){const M={startkey:ye([$]),endkey:ye([$,{}])};return A.update_seq&&(M.update_seq=!0),I(M)}),T=await Promise.all(x),B=ft(T);return F(B)}else{const L={descending:A.descending};A.update_seq&&(L.update_seq=!0);let x,T;if("start_key"in A&&(x=A.start_key),"startkey"in A&&(x=A.startkey),"end_key"in A&&(T=A.end_key),"endkey"in A&&(T=A.endkey),typeof x<"u"&&(L.startkey=A.descending?ye([x,{}]):ye([x])),typeof T<"u"){let $=A.inclusive_end!==!1;A.descending&&($=!$),L.endkey=ye($?[T,{}]:[T])}if(typeof A.key<"u"){const $=ye([A.key]),M=ye([A.key,{}]);L.descending?(L.endkey=$,L.startkey=M):(L.startkey=$,L.endkey=M)}k||(typeof A.limit=="number"&&(L.limit=A.limit),L.skip=R);const B=await I(L);return F(B)}}async function K(S){return(await S.fetch("_view_cleanup",{headers:new Me({"Content-Type":"application/json"}),method:"POST"})).json()}async function N(S){try{const A=await S.get("_local/"+e),D=new ve;Object.keys(A.views).forEach(function(x){const T=Rt(x),B="_design/"+T[0],$=T[1];let M=D.get(B);M||(M=new Ke,D.set(B,M)),M.add($)});const k={keys:Pt(D),include_docs:!0},R=await S.allDocs(k),I={};R.rows.forEach(function(x){const T=x.key.substring(8);D.get(x.key).forEach(function(B){let $=T+"/"+B;A.views[$]||($=B);const M=Object.keys(A.views[$]),X=x.doc&&x.doc.views&&x.doc.views[B];M.forEach(function(V){I[V]=I[V]||X})})});const L=Object.keys(I).filter(function(x){return!I[x]}).map(function(x){return Dt(O(x),function(){return new S.constructor(x,S.__opts).destroy()})()});return Promise.all(L).then(function(){return{ok:!0}})}catch(A){if(A.status===404)return{ok:!0};throw A}}async function G(S,A,D){if(typeof S._query=="function")return h(S,A,D);if(Oe(S))return m(S,A,D);const k={changes_batch_size:S.__opts.view_update_changes_batch_size||js};if(typeof A!="string")return q(D,A),Qn.add(async function(){const R=await zn(S,"temp_view/temp_view",A.map,A.reduce,!0,e);return Ds(E(R,k).then(function(){return j(R,D)}),function(){return R.db.destroy()})}),Qn.finish();{const R=A,I=Rt(R),F=I[0],L=I[1],x=await S.get("_design/"+F);if(A=x.views&&x.views[L],!A)throw new mt(`ddoc ${x._id} has no view named ${L}`);r(x,L),q(D,A);const T=await zn(S,R,A.map,A.reduce,!1,e);return D.stale==="ok"||D.stale==="update_after"?(D.stale==="update_after"&&qe(function(){E(T,k)}),j(T,D)):(await E(T,k),j(T,D))}}function z(S,A,D){const k=this;typeof A=="function"&&(D=A,A={}),A=A?y(A):{},typeof S=="function"&&(S={map:S});const R=Promise.resolve().then(function(){return G(k,S,A)});return jr(R,D),R}const W=Ts(function(){const S=this;return typeof S._viewCleanup=="function"?d(S):Oe(S)?K(S):N(S)});return{query:z,viewCleanup:W}}var Bt={_sum:function(e,t){return Xt(t)},_count:function(e,t){return t.length},_stats:function(e,t){function n(r){for(var i=0,a=0,o=r.length;a<o;a++){var v=r[a];i+=v*v}return i}return{sum:Xt(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:n(t)}}};function Ns(e){if(/^_sum/.test(e))return Bt._sum;if(/^_count/.test(e))return Bt._count;if(/^_stats/.test(e))return Bt._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}function Ms(e,t){if(typeof e=="function"&&e.length===2){var n=e;return function(r){return n(r,t)}}else return Ir(e.toString(),t)}function Us(e){var t=e.toString(),n=Ns(t);return n||Ir(t)}function Ks(e,t){var n=e.views&&e.views[t];if(typeof n.map!="string")throw new mt("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}var Fs="mrviews",$r=$s(Fs,Ms,Us,Ks);function Gs(e,t,n){return $r.query.call(this,e,t,n)}function zs(e){return $r.viewCleanup.call(this,e)}var Js={query:Gs,viewCleanup:zs};function Qs(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}function Hn(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}function Ws(e,t,n){var r=Oe(t)&&!Oe(e),i=Object.keys(n._attachments);return r?e.get(n._id).then(function(a){return Promise.all(i.map(function(o){return Qs(a,n,o)?t.getAttachment(n._id,o):e.getAttachment(a._id,o)}))}).catch(function(a){if(a.status!==404)throw a;return Hn(t,n)}):Hn(t,n)}function Hs(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n].missing;r.forEach(function(i){t.push({id:n,rev:i})})}),{docs:t,revs:!0,latest:!0}}function Xs(e,t,n,r){n=ce(n);var i=[],a=!0;function o(){var g=Hs(n);if(g.docs.length)return e.bulkGet(g).then(function(_){if(r.cancelled)throw new Error("cancelled");return Promise.all(_.results.map(function(b){return Promise.all(b.docs.map(function(l){var p=l.ok;return l.error&&(a=!1),!p||!p._attachments?p:Ws(t,e,p).then(function(y){var w=Object.keys(p._attachments);return y.forEach(function(q,m){var h=p._attachments[w[m]];delete h.stub,delete h.length,h.data=q}),p})}))})).then(function(b){i=i.concat(ft(b).filter(Boolean))})})}function v(){return{ok:a,docs:i}}return Promise.resolve().then(o).then(v)}var Xn=1,Yn="pouchdb",Ys=5,Se=0;function Zt(e,t,n,r,i){return e.get(t).catch(function(a){if(a.status===404)return(e.adapter==="http"||e.adapter==="https")&&It(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:Yn,version:Xn};throw a}).then(function(a){if(!i.cancelled&&a.last_seq!==n)return a.history=(a.history||[]).filter(function(o){return o.session_id!==r}),a.history.unshift({last_seq:n,session_id:r}),a.history=a.history.slice(0,Ys),a.version=Xn,a.replicator=Yn,a.session_id=r,a.last_seq=n,e.put(a).catch(function(o){if(o.status===409)return Zt(e,t,n,r,i);throw o})})}class Zn{constructor(t,n,r,i,a){this.src=t,this.target=n,this.id=r,this.returnValue=i,this.opts=a||{}}writeCheckpoint(t,n){var r=this;return this.updateTarget(t,n).then(function(){return r.updateSource(t,n)})}updateTarget(t,n){return this.opts.writeTargetCheckpoint?Zt(this.target,this.id,t,n,this.returnValue):Promise.resolve(!0)}updateSource(t,n){if(this.opts.writeSourceCheckpoint){var r=this;return Zt(this.src,this.id,t,n,this.returnValue).catch(function(i){if(er(i))return r.opts.writeSourceCheckpoint=!1,!0;throw i})}else return Promise.resolve(!0)}getCheckpoint(){var t=this;return t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(n){return n.last_seq||Se}).catch(function(n){if(n.status!==404)throw n;return Se}):t.target.get(t.id).then(function(n){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?n.last_seq||Se:t.src.get(t.id).then(function(r){if(n.version!==r.version)return Se;var i;return n.version?i=n.version.toString():i="undefined",i in Vn?Vn[i](n,r):Se},function(r){if(r.status===404&&n.last_seq)return t.src.put({_id:t.id,last_seq:Se}).then(function(){return Se},function(i){return er(i)?(t.opts.writeSourceCheckpoint=!1,n.last_seq):Se});throw r})}).catch(function(n){if(n.status!==404)throw n;return Se})}}var Vn={undefined:function(e,t){return ie(e.last_seq,t.last_seq)===0?t.last_seq:0},1:function(e,t){return Zs(t,e).last_seq}};function Zs(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:Nr(e.history,t.history)}function Nr(e,t){var n=e[0],r=e.slice(1),i=t[0],a=t.slice(1);if(!n||t.length===0)return{last_seq:Se,history:[]};var o=n.session_id;if(Vt(o,t))return{last_seq:n.last_seq,history:e};var v=i.session_id;return Vt(v,r)?{last_seq:i.last_seq,history:a}:Nr(r,a)}function Vt(e,t){var n=t[0],r=t.slice(1);return!e||t.length===0?!1:e===n.session_id?!0:Vt(e,r)}function er(e){return typeof e.status=="number"&&Math.floor(e.status/100)===4}function Mr(e,t,n,r,i){return this instanceof Zn?Mr:new Zn(e,t,n,r,i)}var tr=0;function Vs(e,t,n,r){if(e.retry===!1){t.emit("error",n),t.removeAllListeners();return}if(typeof e.back_off_function!="function"&&(e.back_off_function=bi),t.emit("requestError",n),t.state==="active"||t.state==="pending"){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=tr},a=function(){t.removeListener("active",i)};t.once("paused",a),t.once("active",i)}e.current_back_off=e.current_back_off||tr,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}function eu(e){return Object.keys(e).sort(ie).reduce(function(t,n){return t[n]=e[n],t},{})}function tu(e,t,n){var r=n.doc_ids?n.doc_ids.sort(ie):"",i=n.filter?n.filter.toString():"",a="",o="",v="";return n.selector&&(v=JSON.stringify(n.selector)),n.filter&&n.query_params&&(a=JSON.stringify(eu(n.query_params))),n.filter&&n.filter==="_view"&&(o=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(g){var _=g[0]+g[1]+i+o+a+r+v;return new Promise(function(b){dn(_,b)})}).then(function(g){return g=g.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+g})}function Ur(e,t,n,r,i){var a=[],o,v={seq:0,changes:[],docs:[]},g=!1,_=!1,b=!1,l=0,p=0,y=n.continuous||n.live||!1,w=n.batch_size||100,q=n.batches_limit||10,m=n.style||"all_docs",h=!1,d=n.doc_ids,u=n.selector,s,c,f=[],O=yt(),E;i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var C={};r.ready(e,t);function P(){return c?Promise.resolve():tu(e,t,n).then(function(x){s=x;var T={};n.checkpoint===!1?T={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?T={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?T={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:T={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},c=new Mr(e,t,s,r,T)})}function j(){if(f=[],o.docs.length!==0){var x=o.docs,T={timeout:n.timeout};return t.bulkDocs({docs:x,new_edits:!1},T).then(function(B){if(r.cancelled)throw S(),new Error("cancelled");var $=Object.create(null);B.forEach(function(X){X.error&&($[X.id]=X)});var M=Object.keys($).length;i.doc_write_failures+=M,i.docs_written+=x.length-M,x.forEach(function(X){var V=$[X._id];if(V){i.errors.push(V);var ae=(V.name||"").toLowerCase();if(ae==="unauthorized"||ae==="forbidden")r.emit("denied",ce(V));else throw V}else f.push(X)})},function(B){throw i.doc_write_failures+=x.length,B})}}function U(){if(o.error)throw new Error("There was a problem getting docs.");i.last_seq=p=o.seq;var x=ce(i);return f.length&&(x.docs=f,typeof o.pending=="number"&&(x.pending=o.pending,delete o.pending),r.emit("change",x)),g=!0,e.info().then(function(T){var B=e.activeTasks.get(E);if(!(!o||!B)){var $=B.completed_items||0,M=parseInt(T.update_seq,10)-parseInt(l,10);e.activeTasks.update(E,{completed_items:$+o.changes.length,total_items:M})}}),c.writeCheckpoint(o.seq,O).then(function(){if(r.emit("checkpoint",{checkpoint:o.seq}),g=!1,r.cancelled)throw S(),new Error("cancelled");o=void 0,R()}).catch(function(T){throw L(T),T})}function K(){var x={};return o.changes.forEach(function(T){r.emit("checkpoint",{revs_diff:T}),T.id!=="_user/"&&(x[T.id]=T.changes.map(function(B){return B.rev}))}),t.revsDiff(x).then(function(T){if(r.cancelled)throw S(),new Error("cancelled");o.diffs=T})}function N(){return Xs(e,t,o.diffs,r).then(function(x){o.error=!x.ok,x.docs.forEach(function(T){delete o.diffs[T._id],i.docs_read++,o.docs.push(T)})})}function G(){if(!(r.cancelled||o)){if(a.length===0){z(!0);return}o=a.shift(),r.emit("checkpoint",{start_next_batch:o.seq}),K().then(N).then(j).then(U).then(G).catch(function(x){W("batch processing terminated with error",x)})}}function z(x){if(v.changes.length===0){a.length===0&&!o&&((y&&C.live||_)&&(r.state="pending",r.emit("paused")),_&&S());return}(x||_||v.changes.length>=w)&&(a.push(v),v={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),G())}function W(x,T){b||(T.message||(T.message=x),i.ok=!1,i.status="aborting",a=[],v={seq:0,changes:[],docs:[]},S(T))}function S(x){if(!b&&!(r.cancelled&&(i.status="cancelled",g)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=p,b=!0,e.activeTasks.remove(E,x),x){x=J(x),x.result=i;var T=(x.name||"").toLowerCase();T==="unauthorized"||T==="forbidden"?(r.emit("error",x),r.removeAllListeners()):Vs(n,r,x,function(){Ur(e,t,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function A(x,T,B){if(r.cancelled)return S();typeof T=="number"&&(v.pending=T);var $=an(n)(x);if(!$){var M=e.activeTasks.get(E);if(M){var X=M.completed_items||0;e.activeTasks.update(E,{completed_items:++X})}return}v.seq=x.seq||B,v.changes.push(x),r.emit("checkpoint",{pending_batch:v.seq}),qe(function(){z(a.length===0&&C.live)})}function D(x){if(h=!1,r.cancelled)return S();if(x.results.length>0)C.since=x.results[x.results.length-1].seq,R(),z(!0);else{var T=function(){y?(C.live=!0,R()):_=!0,z(!0)};!o&&x.results.length===0?(g=!0,c.writeCheckpoint(x.last_seq,O).then(function(){if(g=!1,i.last_seq=p=x.last_seq,r.cancelled)throw S(),new Error("cancelled");T()}).catch(L)):T()}}function k(x){if(h=!1,r.cancelled)return S();W("changes rejected",x)}function R(){if(!(!h&&!_&&a.length<q))return;h=!0;function x(){B.cancel()}function T(){r.removeListener("cancel",x)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",x);var B=e.changes(C).on("change",A);B.then(T,T),B.then(D).catch(k),n.retry&&(r._changes=B,r._abortChanges=x)}function I(x){return e.info().then(function(T){var B=typeof n.since>"u"?parseInt(T.update_seq,10)-parseInt(x,10):parseInt(T.update_seq,10);return E=e.activeTasks.add({name:`${y?"continuous ":""}replication from ${T.db_name}`,total_items:B}),x})}function F(){P().then(function(){if(r.cancelled){S();return}return c.getCheckpoint().then(I).then(function(x){p=x,l=x,C={since:p,limit:w,batch_size:w,style:m,doc_ids:d,selector:u,return_docs:!0},n.filter&&(typeof n.filter!="string"?C.include_docs=!0:C.filter=n.filter),"heartbeat"in n&&(C.heartbeat=n.heartbeat),"timeout"in n&&(C.timeout=n.timeout),n.query_params&&(C.query_params=n.query_params),n.view&&(C.view=n.view),R()})}).catch(function(x){W("getCheckpoint rejected with ",x)})}function L(x){g=!1,W("writeCheckpoint completed with error",x)}if(r.cancelled){S();return}r._addedListeners||(r.once("cancel",S),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(x){n.complete(null,x)})),r._addedListeners=!0),typeof n.since>"u"?F():P().then(function(){return g=!0,c.writeCheckpoint(n.since,O)}).then(function(){if(g=!1,r.cancelled){S();return}p=n.since,F()}).catch(L)}class nu extends Ce{constructor(){super(),this.cancelled=!1,this.state="pending";const t=new Promise((n,r)=>{this.once("complete",n),this.once("error",r)});this.then=function(n,r){return t.then(n,r)},this.catch=function(n){return t.catch(n)},this.catch(function(){})}cancel(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")}ready(t,n){if(this._readyCalled)return;this._readyCalled=!0;const r=()=>{this.cancel()};t.once("destroyed",r),n.once("destroyed",r);function i(){t.removeListener("destroyed",r),n.removeListener("destroyed",r)}this.once("complete",i),this.once("error",i)}}function vt(e,t){var n=t.PouchConstructor;return typeof e=="string"?new n(e,t):e}function en(e,t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw J(pt,"`doc_ids` filter parameter is not a list.");n.complete=r,n=ce(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new nu(n),a=vt(e,n),o=vt(t,n);return Ur(a,o,n,i),i}function ru(e,t,n,r){return typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n=ce(n),n.PouchConstructor=n.PouchConstructor||this,e=vt(e,n),t=vt(t,n),new iu(e,t,n,r)}class iu extends Ce{constructor(t,n,r,i){super(),this.canceled=!1;const a=r.push?Le({},r,r.push):r,o=r.pull?Le({},r,r.pull):r;this.push=en(t,n,a),this.pull=en(n,t,o),this.pushPaused=!0,this.pullPaused=!0;const v=u=>{this.emit("change",{direction:"pull",change:u})},g=u=>{this.emit("change",{direction:"push",change:u})},_=u=>{this.emit("denied",{direction:"push",doc:u})},b=u=>{this.emit("denied",{direction:"pull",doc:u})},l=()=>{this.pushPaused=!0,this.pullPaused&&this.emit("paused")},p=()=>{this.pullPaused=!0,this.pushPaused&&this.emit("paused")},y=()=>{this.pushPaused=!1,this.pullPaused&&this.emit("active",{direction:"push"})},w=()=>{this.pullPaused=!1,this.pushPaused&&this.emit("active",{direction:"pull"})};let q={};const m=u=>(s,c)=>{(s==="change"&&(c===v||c===g)||s==="denied"&&(c===b||c===_)||s==="paused"&&(c===p||c===l)||s==="active"&&(c===w||c===y))&&(s in q||(q[s]={}),q[s][u]=!0,Object.keys(q[s]).length===2&&this.removeAllListeners(s))};r.live&&(this.push.on("complete",this.pull.cancel.bind(this.pull)),this.pull.on("complete",this.push.cancel.bind(this.push)));function h(u,s,c){u.listeners(s).indexOf(c)==-1&&u.on(s,c)}this.on("newListener",function(u){u==="change"?(h(this.pull,"change",v),h(this.push,"change",g)):u==="denied"?(h(this.pull,"denied",b),h(this.push,"denied",_)):u==="active"?(h(this.pull,"active",w),h(this.push,"active",y)):u==="paused"&&(h(this.pull,"paused",p),h(this.push,"paused",l))}),this.on("removeListener",function(u){u==="change"?(this.pull.removeListener("change",v),this.push.removeListener("change",g)):u==="denied"?(this.pull.removeListener("denied",b),this.push.removeListener("denied",_)):u==="active"?(this.pull.removeListener("active",w),this.push.removeListener("active",y)):u==="paused"&&(this.pull.removeListener("paused",p),this.push.removeListener("paused",l))}),this.pull.on("removeListener",m("pull")),this.push.on("removeListener",m("push"));const d=Promise.all([this.push,this.pull]).then(u=>{const s={push:u[0],pull:u[1]};return this.emit("complete",s),i&&i(null,s),this.removeAllListeners(),s},u=>{if(this.cancel(),i?i(u):this.emit("error",u),this.removeAllListeners(),i)throw u});this.then=function(u,s){return d.then(u,s)},this.catch=function(u){return d.catch(u)}}cancel(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}}function au(e){e.replicate=en,e.sync=ru,Object.defineProperty(e.prototype,"replicate",{get:function(){var t=this;return typeof this.replicateMethods>"u"&&(this.replicateMethods={from:function(n,r,i){return t.constructor.replicate(n,t,r,i)},to:function(n,r,i){return t.constructor.replicate(t,n,r,i)}}),this.replicateMethods}}),e.prototype.sync=function(t,n,r){return this.constructor.sync(this,t,n,r)}}Q.plugin(bs).plugin(ks).plugin(Js).plugin(au);const uu=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"}));export{su as c,gt as g,uu as i,zr as r};
